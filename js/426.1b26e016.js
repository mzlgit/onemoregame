"use strict";(self.webpackChunkvue_project=self.webpackChunkvue_project||[]).push([[426],{8423:function(t,e,i){i.d(e,{AO:function(){return n},F5:function(){return ae},JO:function(){return le},KK:function(){return ot},kp:function(){return re},q3:function(){return as},uT:function(){return k},xu:function(){return q}}),i(8409),i(9991),i(6914),i(3677);class s{constructor(t){this.elements=t=void 0===t?[0,0,0,0,0,0,0,0,0]:t}identity(){var t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1}setZero(){var t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0}setTrace(t){var e=this.elements;e[0]=t.x,e[4]=t.y,e[8]=t.z}getTrace(t){void 0===t&&(t=new n);var e=this.elements;return t.x=e[0],t.y=e[4],t.z=e[8],t}vmult(t,e){void 0===e&&(e=new n);var i=this.elements,s=t.x,o=t.y;t=t.z;return e.x=i[0]*s+i[1]*o+i[2]*t,e.y=i[3]*s+i[4]*o+i[5]*t,e.z=i[6]*s+i[7]*o+i[8]*t,e}smult(t){for(let e=0;e<this.elements.length;e++)this.elements[e]*=t}mmult(t,e){void 0===e&&(e=new s);var i=this.elements,o=(t=t.elements,e.elements),n=i[0],r=i[1],a=i[2],l=i[3],h=i[4],u=i[5],c=i[6],d=i[7],p=(i=i[8],t[0]),v=t[1],y=t[2],w=t[3],m=t[4],f=t[5],g=t[6],x=t[7];t=t[8];return o[0]=n*p+r*w+a*g,o[1]=n*v+r*m+a*x,o[2]=n*y+r*f+a*t,o[3]=l*p+h*w+u*g,o[4]=l*v+h*m+u*x,o[5]=l*y+h*f+u*t,o[6]=c*p+d*w+i*g,o[7]=c*v+d*m+i*x,o[8]=c*y+d*f+i*t,e}scale(t,e){void 0===e&&(e=new s);var i=this.elements,o=e.elements;for(let s=0;3!==s;s++)o[3*s+0]=t.x*i[3*s+0],o[3*s+1]=t.y*i[3*s+1],o[3*s+2]=t.z*i[3*s+2];return e}solve(t,e){void 0===e&&(e=new n);var i=[];let s,o;for(s=0;s<12;s++)i.push(0);for(s=0;s<3;s++)for(o=0;o<3;o++)i[s+4*o]=this.elements[s+3*o];i[3]=t.x,i[7]=t.y,i[11]=t.z;let r=3;var a=r;let l,h;do{if(0===i[(s=a-r)+4*s])for(o=s+1;o<a;o++)if(0!==i[s+4*o]){for(l=4;i[(h=4-l)+4*s]+=i[h+4*o],--l;);break}if(0!==i[s+4*s])for(o=s+1;o<a;o++){var u=i[s+4*o]/i[s+4*s];for(l=4;i[(h=4-l)+4*o]=h<=s?0:i[h+4*o]-i[h+4*s]*u,--l;);}}while(--r);if(e.z=i[11]/i[10],e.y=(i[7]-i[6]*e.z)/i[5],e.x=(i[3]-i[2]*e.z-i[1]*e.y)/i[0],isNaN(e.x)||isNaN(e.y)||isNaN(e.z)||e.x===1/0||e.y===1/0||e.z===1/0)throw`Could not solve equation! Got x=[${e.toString()}], b=[${t.toString()}], A=[${this.toString()}]`;return e}e(t,e,i){if(void 0===i)return this.elements[e+3*t];this.elements[e+3*t]=i}copy(t){for(let e=0;e<t.elements.length;e++)this.elements[e]=t.elements[e];return this}toString(){let t="";for(let e=0;e<9;e++)t+=this.elements[e]+",";return t}reverse(t){void 0===t&&(t=new s);var e=o;let i,n;for(i=0;i<3;i++)for(n=0;n<3;n++)e[i+6*n]=this.elements[i+3*n];e[3]=1,e[9]=0,e[15]=0,e[4]=0,e[10]=1,e[16]=0,e[5]=0,e[11]=0,e[17]=1;let r=3;var a=r;let l,h;do{if(0===e[(i=a-r)+6*i])for(n=i+1;n<a;n++)if(0!==e[i+6*n]){for(l=6;e[(h=6-l)+6*i]+=e[h+6*n],--l;);break}if(0!==e[i+6*i])for(n=i+1;n<a;n++){var u=e[i+6*n]/e[i+6*i];for(l=6;e[(h=6-l)+6*n]=h<=i?0:e[h+6*n]-e[h+6*i]*u,--l;);}}while(--r);i=2;do{n=i-1;do{var c=e[i+6*n]/e[i+6*i];for(l=6;e[(h=6-l)+6*n]=e[h+6*n]-e[h+6*i]*c,--l;);}while(n--)}while(--i);i=2;do{var d=1/e[i+6*i];for(l=6;e[(h=6-l)+6*i]=e[h+6*i]*d,--l;);}while(i--);i=2;do{n=2;do{if(h=e[3+n+6*i],isNaN(h)||h===1/0)throw`Could not reverse! A=[${this.toString()}]`}while(t.e(i,n,h),n--)}while(i--);return t}setRotationFromQuaternion(t){var e=t.x,i=t.y,s=t.z,o=(t=t.w,e+e),n=i+i,r=s+s,a=e*o,l=e*n,h=(e=e*r,i*n);i*=r,s*=r,o*=t,n*=t,t*=r,r=this.elements;return r[0]=1-(h+s),r[1]=l-t,r[2]=e+n,r[3]=l+t,r[4]=1-(a+s),r[5]=i-o,r[6]=e-n,r[7]=i+o,r[8]=1-(a+h),this}transpose(t){void 0===t&&(t=new s);var e,i=this.elements,o=t.elements;return o[0]=i[0],o[4]=i[4],o[8]=i[8],e=i[1],o[1]=i[3],o[3]=e,e=i[2],o[2]=i[6],o[6]=e,e=i[5],o[5]=i[7],o[7]=e,t}}const o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class n{constructor(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this.x=t=void 0===t?0:t,this.y=e,this.z=i}cross(t,e){void 0===e&&(e=new n);var i=t.x,s=t.y,o=(t=t.z,this.x),r=this.y,a=this.z;return e.x=r*t-a*s,e.y=a*i-o*t,e.z=o*s-r*i,e}set(t,e,i){return this.x=t,this.y=e,this.z=i,this}setZero(){this.x=this.y=this.z=0}vadd(t,e){if(!e)return new n(this.x+t.x,this.y+t.y,this.z+t.z);e.x=t.x+this.x,e.y=t.y+this.y,e.z=t.z+this.z}vsub(t,e){if(!e)return new n(this.x-t.x,this.y-t.y,this.z-t.z);e.x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z}crossmat(){return new s([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){var t=this.x,e=this.y,i=this.z;t=Math.sqrt(t*t+e*e+i*i);return 0<t?(this.x*=e=1/t,this.y*=e,this.z*=e):(this.x=0,this.y=0,this.z=0),t}unit(t){void 0===t&&(t=new n);var e=this.x,i=this.y,s=this.z,o=Math.sqrt(e*e+i*i+s*s);return 0<o?(t.x=e*(o=1/o),t.y=i*o,t.z=s*o):(t.x=1,t.y=0,t.z=0),t}length(){var t=this.x,e=this.y,i=this.z;return Math.sqrt(t*t+e*e+i*i)}lengthSquared(){return this.dot(this)}distanceTo(t){var e=this.x,i=this.y,s=this.z,o=t.x,n=t.y;t=t.z;return Math.sqrt((o-e)*(o-e)+(n-i)*(n-i)+(t-s)*(t-s))}distanceSquared(t){var e=this.x,i=this.y,s=this.z,o=t.x,n=t.y;t=t.z;return(o-e)*(o-e)+(n-i)*(n-i)+(t-s)*(t-s)}scale(t,e){void 0===e&&(e=new n);var i=this.x,s=this.y,o=this.z;return e.x=t*i,e.y=t*s,e.z=t*o,e}vmul(t,e){return(e=void 0===e?new n:e).x=t.x*this.x,e.y=t.y*this.y,e.z=t.z*this.z,e}addScaledVector(t,e,i){return(i=void 0===i?new n:i).x=this.x+t*e.x,i.y=this.y+t*e.y,i.z=this.z+t*e.z,i}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}isZero(){return 0===this.x&&0===this.y&&0===this.z}negate(t){return(t=void 0===t?new n:t).x=-this.x,t.y=-this.y,t.z=-this.z,t}tangents(t,e){var i,s=this.length();0<s?((i=r).set(this.x*(s=1/s),this.y*s,this.z*s),s=a,Math.abs(i.x)<.9?s.set(1,0,0):s.set(0,1,0),i.cross(s,t),i.cross(t,e)):(t.set(1,0,0),e.set(0,1,0))}toString(){return`${this.x},${this.y},`+this.z}toArray(){return[this.x,this.y,this.z]}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}lerp(t,e,i){var s=this.x,o=this.y,n=this.z;i.x=s+(t.x-s)*e,i.y=o+(t.y-o)*e,i.z=n+(t.z-n)*e}almostEquals(t,e){return void 0===e&&(e=1e-6),!(Math.abs(this.x-t.x)>e||Math.abs(this.y-t.y)>e||Math.abs(this.z-t.z)>e)}almostZero(t){return void 0===t&&(t=1e-6),!(Math.abs(this.x)>t||Math.abs(this.y)>t||Math.abs(this.z)>t)}isAntiparallelTo(t,e){return this.negate(l),l.almostEquals(t,e)}clone(){return new n(this.x,this.y,this.z)}}n.ZERO=new n(0,0,0),n.UNIT_X=new n(1,0,0),n.UNIT_Y=new n(0,1,0),n.UNIT_Z=new n(0,0,1);const r=new n,a=new n,l=new n;class h{constructor(t){void 0===t&&(t={}),this.lowerBound=new n,this.upperBound=new n,t.lowerBound&&this.lowerBound.copy(t.lowerBound),t.upperBound&&this.upperBound.copy(t.upperBound)}setFromPoints(t,e,i,s){var o=this.lowerBound,n=this.upperBound,r=i;o.copy(t[0]),r&&r.vmult(o,o),n.copy(o);for(let a=1;a<t.length;a++){let e=t[a];r&&(r.vmult(e,u),e=u),e.x>n.x&&(n.x=e.x),e.x<o.x&&(o.x=e.x),e.y>n.y&&(n.y=e.y),e.y<o.y&&(o.y=e.y),e.z>n.z&&(n.z=e.z),e.z<o.z&&(o.z=e.z)}return e&&(e.vadd(o,o),e.vadd(n,n)),s&&(o.x-=s,o.y-=s,o.z-=s,n.x+=s,n.y+=s,n.z+=s),this}copy(t){return this.lowerBound.copy(t.lowerBound),this.upperBound.copy(t.upperBound),this}clone(){return(new h).copy(this)}extend(t){this.lowerBound.x=Math.min(this.lowerBound.x,t.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,t.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,t.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,t.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,t.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,t.upperBound.z)}overlaps(t){var e=this.lowerBound,i=this.upperBound,s=t.lowerBound,o=(t=t.upperBound,s.x<=i.x&&i.x<=t.x||e.x<=t.x&&t.x<=i.x),n=s.y<=i.y&&i.y<=t.y||e.y<=t.y&&t.y<=i.y;s=s.z<=i.z&&i.z<=t.z||e.z<=t.z&&t.z<=i.z;return o&&n&&s}volume(){var t=this.lowerBound,e=this.upperBound;return(e.x-t.x)*(e.y-t.y)*(e.z-t.z)}contains(t){var e=this.lowerBound,i=this.upperBound,s=t.lowerBound;t=t.upperBound;return e.x<=s.x&&i.x>=t.x&&e.y<=s.y&&i.y>=t.y&&e.z<=s.z&&i.z>=t.z}getCorners(t,e,i,s,o,n,r,a){var l=this.lowerBound,h=this.upperBound;t.copy(l),e.set(h.x,l.y,l.z),i.set(h.x,h.y,l.z),s.set(l.x,h.y,h.z),o.set(h.x,l.y,h.z),n.set(l.x,h.y,l.z),r.set(l.x,l.y,h.z),a.copy(h)}toLocalFrame(t,e){var i=c,s=i[0],o=i[1],n=i[2],r=i[3],a=i[4],l=i[5],h=i[6],u=i[7];this.getCorners(s,o,n,r,a,l,h,u);for(let c=0;8!==c;c++){var d=i[c];t.pointToLocal(d,d)}return e.setFromPoints(i)}toWorldFrame(t,e){var i=c,s=i[0],o=i[1],n=i[2],r=i[3],a=i[4],l=i[5],h=i[6],u=i[7];this.getCorners(s,o,n,r,a,l,h,u);for(let c=0;8!==c;c++){var d=i[c];t.pointToWorld(d,d)}return e.setFromPoints(i)}overlapsRay(t){var{direction:t,from:e}=t,i=1/t.x,s=1/t.y,o=(t=1/t.z,(this.lowerBound.x-e.x)*i),n=(i=(this.upperBound.x-e.x)*i,(this.lowerBound.y-e.y)*s),r=(s=(this.upperBound.y-e.y)*s,(this.lowerBound.z-e.z)*t),e=(this.upperBound.z-e.z)*t;t=Math.max(Math.max(Math.min(o,i),Math.min(n,s)),Math.min(r,e)),o=Math.min(Math.min(Math.max(o,i),Math.max(n,s)),Math.max(r,e));return!(o<0||o<t)}}const u=new n,c=[new n,new n,new n,new n,new n,new n,new n,new n];class d{constructor(){this.matrix=[]}get(t,e){let i=t["index"],s=e["index"];return s>i&&(t=s,s=i,i=t),this.matrix[(i*(i+1)>>1)+s-1]}set(t,e,i){let s=t["index"],o=e["index"];o>s&&(t=o,o=s,s=t),this.matrix[(s*(s+1)>>1)+o-1]=i?1:0}reset(){for(let t=0,e=this.matrix.length;t!==e;t++)this.matrix[t]=0}setNumObjects(t){this.matrix.length=t*(t-1)>>1}}class p{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});var i=this._listeners;return void 0===i[t]&&(i[t]=[]),i[t].includes(e)||i[t].push(e),this}hasEventListener(t,e){var i;return void 0!==this._listeners&&!(void 0===(i=this._listeners)[t]||!i[t].includes(e))}hasAnyEventListener(t){return void 0!==this._listeners&&void 0!==this._listeners[t]}removeEventListener(t,e){var i,s;return void 0!==this._listeners&&void 0!==(i=this._listeners)[t]&&-1!==(s=i[t].indexOf(e))&&i[t].splice(s,1),this}dispatchEvent(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(let i=0,s=e.length;i<s;i++)e[i].call(this,t)}}return this}}class v{constructor(t,e,i,s){void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=1),this.x=t=void 0===t?0:t,this.y=e,this.z=i,this.w=s}set(t,e,i,s){return this.x=t,this.y=e,this.z=i,this.w=s,this}toString(){return`${this.x},${this.y},${this.z},`+this.w}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(t,e){var i=Math.sin(.5*e);return this.x=t.x*i,this.y=t.y*i,this.z=t.z*i,this.w=Math.cos(.5*e),this}toAxisAngle(t){void 0===t&&(t=new n),this.normalize();var e=2*Math.acos(this.w),i=Math.sqrt(1-this.w*this.w);return i<.001?(t.x=this.x,t.y=this.y,t.z=this.z):(t.x=this.x/i,t.y=this.y/i,t.z=this.z/i),[t,e]}setFromVectors(t,e){var i,s;return t.isAntiparallelTo(e)?(i=y,s=w,t.tangents(i,s),this.setFromAxisAngle(i,Math.PI)):(s=t.cross(e),this.x=s.x,this.y=s.y,this.z=s.z,this.w=Math.sqrt(t.length()**2*e.length()**2)+t.dot(e),this.normalize()),this}mult(t,e){void 0===e&&(e=new v);var i=this.x,s=this.y,o=this.z,n=this.w,r=t.x,a=t.y,l=t.z;t=t.w;return e.x=i*t+n*r+s*l-o*a,e.y=s*t+n*a+o*r-i*l,e.z=o*t+n*l+i*a-s*r,e.w=n*t-i*r-s*a-o*l,e}inverse(t){void 0===t&&(t=new v);var e=this.x,i=this.y,s=this.z,o=this.w;this.conjugate(t),e=1/(e*e+i*i+s*s+o*o);return t.x*=e,t.y*=e,t.z*=e,t.w*=e,t}conjugate(t){return(t=void 0===t?new v:t).x=-this.x,t.y=-this.y,t.z=-this.z,t.w=this.w,t}normalize(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=t=1/t,this.y*=t,this.z*=t,this.w*=t),this}normalizeFast(){var t=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0==t?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}vmult(t,e){void 0===e&&(e=new n);var i=t.x,s=t.y,o=(t=t.z,this.x),r=this.y,a=this.z,l=this.w,h=l*i+r*t-a*s,u=l*s+a*i-o*t,c=l*t+o*s-r*i;i=-o*i-r*s-a*t;return e.x=h*l+i*-o+u*-a-c*-r,e.y=u*l+i*-r+c*-o-h*-a,e.z=c*l+i*-a+h*-r-u*-o,e}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}toEuler(t,e){let i,s,o;void 0===e&&(e="YZX");var n=this.x,r=this.y,a=this.z,l=this.w;if("YZX"!==e)throw new Error(`Euler order ${e} not supported yet.`);var h,u;e=n*r+a*l;.499<e&&(i=2*Math.atan2(n,l),s=Math.PI/2,o=0),e<-.499&&(i=-2*Math.atan2(n,l),s=-Math.PI/2,o=0),void 0===i&&(h=n*n,u=a*a,i=Math.atan2(2*r*l-2*n*a,1-r*r*2-2*u),s=Math.asin(2*e),o=Math.atan2(2*n*l-2*r*a,1-2*h-2*u)),t.y=i,t.z=s,t.x=o}setFromEuler(t,e,i,s){void 0===s&&(s="XYZ");var o=Math.cos(t/2),n=Math.cos(e/2),r=Math.cos(i/2);t=Math.sin(t/2),e=Math.sin(e/2),i=Math.sin(i/2);return"XYZ"===s?(this.x=t*n*r+o*e*i,this.y=o*e*r-t*n*i,this.z=o*n*i+t*e*r,this.w=o*n*r-t*e*i):"YXZ"===s?(this.x=t*n*r+o*e*i,this.y=o*e*r-t*n*i,this.z=o*n*i-t*e*r,this.w=o*n*r+t*e*i):"ZXY"===s?(this.x=t*n*r-o*e*i,this.y=o*e*r+t*n*i,this.z=o*n*i+t*e*r,this.w=o*n*r-t*e*i):"ZYX"===s?(this.x=t*n*r-o*e*i,this.y=o*e*r+t*n*i,this.z=o*n*i-t*e*r,this.w=o*n*r+t*e*i):"YZX"===s?(this.x=t*n*r+o*e*i,this.y=o*e*r+t*n*i,this.z=o*n*i-t*e*r,this.w=o*n*r-t*e*i):"XZY"===s&&(this.x=t*n*r-o*e*i,this.y=o*e*r-t*n*i,this.z=o*n*i+t*e*r,this.w=o*n*r+t*e*i),this}clone(){return new v(this.x,this.y,this.z,this.w)}slerp(t,e,i){void 0===i&&(i=new v);var s,o=this.x,n=this.y,r=this.z,a=this.w;let l,h,u,c=t.x,d=t.y,p=t.z,y=t.w;return(l=o*c+n*d+r*p+a*y)<0&&(l=-l,c=-c,d=-d,p=-p,y=-y),u=1e-6<1-l?(t=Math.acos(l),s=Math.sin(t),h=Math.sin((1-e)*t)/s,Math.sin(e*t)/s):(h=1-e,e),i.x=h*o+u*c,i.y=h*n+u*d,i.z=h*r+u*p,i.w=h*a+u*y,i}integrate(t,e,i,s){void 0===s&&(s=new v);var o=t.x*i.x,n=t.y*i.y,r=(t=t.z*i.z,i=this.x,this.y),a=this.z,l=this.w;e*=.5;return s.x+=e*(o*l+n*a-t*r),s.y+=e*(n*l+t*i-o*a),s.z+=e*(t*l+o*r-n*i),s.w+=e*(-o*i-n*r-t*a),s}}const y=new n,w=new n;var m,f,g,x,b;class E{constructor(t){void 0===t&&(t={}),this.id=E.idCounter++,this.type=t.type||0,this.boundingSphereRadius=0,this.collisionResponse=t.collisionResponse||!0,this.collisionFilterGroup=void 0!==t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask=void 0!==t.collisionFilterMask?t.collisionFilterMask:-1,this.material=t.material||null,this.body=null}updateBoundingSphereRadius(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type}volume(){throw"volume() not implemented for shape type "+this.type}calculateLocalInertia(t,e){throw"calculateLocalInertia() not implemented for shape type "+this.type}calculateWorldAABB(t,e,i,s){throw"calculateWorldAABB() not implemented for shape type "+this.type}}E.idCounter=0,E.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class z{constructor(t){void 0===t&&(t={}),this.position=new n,this.quaternion=new v,t.position&&this.position.copy(t.position),t.quaternion&&this.quaternion.copy(t.quaternion)}pointToLocal(t,e){return z.pointToLocalFrame(this.position,this.quaternion,t,e)}pointToWorld(t,e){return z.pointToWorldFrame(this.position,this.quaternion,t,e)}vectorToWorldFrame(t,e){return void 0===e&&(e=new n),this.quaternion.vmult(t,e),e}static pointToLocalFrame(t,e,i,s){return void 0===s&&(s=new n),i.vsub(t,s),e.conjugate(S),S.vmult(s,s),s}static pointToWorldFrame(t,e,i,s){return void 0===s&&(s=new n),e.vmult(i,s),s.vadd(t,s),s}static vectorToWorldFrame(t,e,i){return void 0===i&&(i=new n),t.vmult(e,i),i}static vectorToLocalFrame(t,e,i,s){return void 0===s&&(s=new n),e.w*=-1,e.vmult(i,s),e.w*=-1,s}}const S=new v;class B extends E{constructor(t){var{vertices:t=[],faces:e=[],normals:i=[],axes:s,boundingSphereRadius:o}=t=void 0===t?{}:t;super({type:E.types.CONVEXPOLYHEDRON}),this.vertices=t,this.faces=e,this.faceNormals=i,0===this.faceNormals.length&&this.computeNormals(),o?this.boundingSphereRadius=o:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=s?s.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){var t=this.faces,e=this.vertices,i=this.uniqueEdges,s=(i.length=0,new n);for(let n=0;n!==t.length;n++){var o=t[n],r=o.length;for(let t=0;t!==r;t++){var a=(t+1)%r;e[o[t]].vsub(e[o[a]],s),s.normalize();let n=!1;for(let t=0;t!==i.length;t++)if(i[t].almostEquals(s)||i[t].almostEquals(s)){n=!0;break}n||i.push(s.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let i=0;i<this.faces.length;i++){for(let t=0;t<this.faces[i].length;t++)if(!this.vertices[this.faces[i][t]])throw new Error(`Vertex ${this.faces[i][t]} not found!`);var t=this.faceNormals[i]||new n,e=(this.getFaceNormal(i,t),t.negate(t),this.faceNormals[i]=t,this.vertices[this.faces[i][0]]);if(t.dot(e)<0)for(let t=0;t<this.faces[i].length;t++);}}getFaceNormal(t,e){t=this.faces[t];var i=this.vertices[t[0]],s=this.vertices[t[1]];t=this.vertices[t[2]];B.computeNormal(i,s,t,e)}static computeNormal(t,e,i,s){var o=new n,r=new n;e.vsub(t,r),i.vsub(e,o),o.cross(r,s),s.isZero()||s.normalize()}clipAgainstHull(t,e,i,s,o,r,a,l,h){var u=new n;let c=-1,d=-Number.MAX_VALUE;for(let n=0;n<i.faces.length;n++){u.copy(i.faceNormals[n]),o.vmult(u,u);var p=u.dot(r);p>d&&(d=p,c=n)}var v=[];for(let m=0;m<i.faces[c].length;m++){var y=i.vertices[i.faces[c][m]],w=new n;w.copy(y),o.vmult(w,w),s.vadd(w,w),v.push(w)}0<=c&&this.clipFaceAgainstHull(r,t,e,v,a,l,h)}findSeparatingAxis(t,e,i,s,o,r,a,l){var h=new n,u=new n,c=new n,d=new n,p=new n,v=new n;let y=Number.MAX_VALUE;var w=this;if(w.uniqueAxes)for(let n=0;n!==w.uniqueAxes.length;n++){i.vmult(w.uniqueAxes[n],h);var m=w.testSepAxis(h,t,e,i,s,o);if(!1===m)return!1;m<y&&(y=m,r.copy(h))}else{var f=(a||w.faces).length;for(let n=0;n<f;n++){var g=a?a[n]:n;g=(h.copy(w.faceNormals[g]),i.vmult(h,h),w.testSepAxis(h,t,e,i,s,o));if(!1===g)return!1;g<y&&(y=g,r.copy(h))}}if(t.uniqueAxes)for(let n=0;n!==t.uniqueAxes.length;n++){o.vmult(t.uniqueAxes[n],u);var x=w.testSepAxis(u,t,e,i,s,o);if(!1===x)return!1;x<y&&(y=x,r.copy(u))}else{var b=(l||t.faces).length;for(let n=0;n<b;n++){var E=l?l[n]:n;E=(u.copy(t.faceNormals[E]),o.vmult(u,u),w.testSepAxis(u,t,e,i,s,o));if(!1===E)return!1;E<y&&(y=E,r.copy(u))}}for(let n=0;n!==w.uniqueEdges.length;n++){i.vmult(w.uniqueEdges[n],d);for(let n=0;n!==t.uniqueEdges.length;n++)if(o.vmult(t.uniqueEdges[n],p),d.cross(p,v),!v.almostZero()){v.normalize();var z=w.testSepAxis(v,t,e,i,s,o);if(!1===z)return!1;z<y&&(y=z,r.copy(v))}}return s.vsub(e,c),0<c.dot(r)&&r.negate(r),!0}testSepAxis(t,e,i,s,o,n){return B.project(this,t,i,s,A),B.project(e,t,o,n,C),i=A[0],s=A[1],e=C[0],t=C[1],!(i<t||e<s)&&((o=i-t)<(n=e-s)?o:n)}calculateLocalInertia(t,e){var i=new n,s=new n,o=(this.computeLocalAABB(s,i),i.x-s.x),r=i.y-s.y;i=i.z-s.z;e.x=1/12*t*(2*r*2*r+2*i*2*i),e.y=1/12*t*(2*o*2*o+2*i*2*i),e.z=1/12*t*(2*r*2*r+2*o*2*o)}getPlaneConstantOfFace(t){var e=this.faces[t];t=this.faceNormals[t],e=this.vertices[e[0]];return-t.dot(e)}clipFaceAgainstHull(t,e,i,s,o,r,a){var l=new n,h=new n,u=new n,c=new n,d=new n,p=new n,v=new n,y=new n,w=this,m=s,f=[];let g=-1,x=Number.MAX_VALUE;for(let n=0;n<w.faces.length;n++){l.copy(w.faceNormals[n]),i.vmult(l,l);var b=l.dot(t);b<x&&(x=b,g=n)}if(!(g<0)){var E=w.faces[g];E.connectedFaces=[];for(let e=0;e<w.faces.length;e++)for(let t=0;t<w.faces[e].length;t++)-1!==E.indexOf(w.faces[e][t])&&e!==g&&-1===E.connectedFaces.indexOf(e)&&E.connectedFaces.push(e);var z,S=E.length;for(let o=0;o<S;o++){var B=w.vertices[E[o]],A=w.vertices[E[(o+1)%S]];A=(B.vsub(A,h),u.copy(h),i.vmult(u,u),e.vadd(u,u),c.copy(this.faceNormals[g]),i.vmult(c,c),e.vadd(c,c),u.cross(c,d),d.negate(d),p.copy(B),i.vmult(p,p),e.vadd(p,p),E.connectedFaces[o]);v.copy(this.faceNormals[A]);const t=this.getPlaneConstantOfFace(A),s=(y.copy(v),i.vmult(y,y),t-y.dot(e));for(this.clipFaceAgainstPlane(m,f,y,s);m.length;)m.shift();for(;f.length;)m.push(f.shift())}v.copy(this.faceNormals[g]);const t=this.getPlaneConstantOfFace(g),s=(y.copy(v),i.vmult(y,y),t-y.dot(e));for(let e=0;e<m.length;e++){let t=y.dot(m[e])+s;(t=t<=o?o:t)<=r&&(z=m[e],t<=1e-6)&&(z={point:z,normal:y,depth:t},a.push(z))}}}clipFaceAgainstPlane(t,e,i,s){let o;var r=t.length;if(!(r<2)){let c=t[t.length-1];t[0],o=i.dot(c)+s;for(let d=0;d<r;d++){var a,l,h=t[d],u=i.dot(h)+s;o<0?u<0?((a=new n).copy(h),e.push(a)):(a=new n,c.lerp(h,o/(o-u),a),e.push(a)):u<0&&(l=new n,c.lerp(h,o/(o-u),l),e.push(l),e.push(h)),c=h,o=u}}return e}computeWorldVertices(t,e){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new n);var i=this.vertices,s=this.worldVertices;for(let o=0;o!==this.vertices.length;o++)e.vmult(i[o],s[o]),t.vadd(s[o],s[o]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(t,e){var i=this.vertices;t.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let o=0;o<this.vertices.length;o++){var s=i[o];s.x<t.x?t.x=s.x:s.x>e.x&&(e.x=s.x),s.y<t.y?t.y=s.y:s.y>e.y&&(e.y=s.y),s.z<t.z?t.z=s.z:s.z>e.z&&(e.z=s.z)}}computeWorldFaceNormals(t){for(var e=this.faceNormals.length;this.worldFaceNormals.length<e;)this.worldFaceNormals.push(new n);var i=this.faceNormals,s=this.worldFaceNormals;for(let o=0;o!==e;o++)t.vmult(i[o],s[o]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let t=0;var e=this.vertices;for(let s=0;s!==e.length;s++){var i=e[s].lengthSquared();i>t&&(t=i)}this.boundingSphereRadius=Math.sqrt(t)}calculateWorldAABB(t,e,i,s){var o=this.vertices;let r,a,l,h,u,c;var d=new n;for(let n=0;n<o.length;n++)d.copy(o[n]),e.vmult(d,d),t.vadd(d,d),(void 0===r||d.x<r)&&(r=d.x),(void 0===h||d.x>h)&&(h=d.x),(void 0===a||d.y<a)&&(a=d.y),(void 0===u||d.y>u)&&(u=d.y),(void 0===l||d.z<l)&&(l=d.z),(void 0===c||d.z>c)&&(c=d.z);i.set(r,a,l),s.set(h,u,c)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(t){void 0===t&&(t=new n);var e=this.vertices;for(let i=0;i<e.length;i++)t.vadd(e[i],t);return t.scale(1/e.length,t),t}transformAllPoints(t,e){var i=this.vertices.length,s=this.vertices;if(e){for(let t=0;t<i;t++){var o=s[t];e.vmult(o,o)}for(let t=0;t<this.faceNormals.length;t++){var n=this.faceNormals[t];e.vmult(n,n)}}if(t)for(let a=0;a<i;a++){var r=s[a];r.vadd(t,r)}}pointIsInside(t){var e=this.vertices,i=this.faces,s=this.faceNormals,o=new n;this.getAveragePointLocal(o);for(let u=0;u<this.faces.length;u++){var r=s[u],a=e[i[u][0]],l=new n,h=(l=(t.vsub(a,l),r.dot(l)),new n);a=(o.vsub(a,h),r.dot(h));if(l<0&&0<a||0<l&&a<0)return!1}return-1}static project(t,e,i,s,o){var n=t.vertices.length,r=M;let a=0,l=0;var h=F,u=t.vertices;h.setZero(),z.vectorToLocalFrame(i,s,e,r),z.pointToLocalFrame(i,s,h,h),t=h.dot(r);l=a=u[0].dot(r);for(let d=1;d<n;d++){var c=u[d].dot(r);c>a&&(a=c),c<l&&(l=c)}l-=t,a-=t,l>a&&(e=l,l=a,a=e),o[0]=a,o[1]=l}}const A=[],C=[],M=(new n,new n),F=new n;class q extends E{constructor(t){super({type:E.types.BOX}),this.halfExtents=t,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){var t=this.halfExtents.x,e=this.halfExtents.y,i=this.halfExtents.z,s=n;t=[new s(-t,-e,-i),new s(t,-e,-i),new s(t,e,-i),new s(-t,e,-i),new s(-t,-e,i),new s(t,-e,i),new s(t,e,i),new s(-t,e,i)],e=[new s(0,0,1),new s(0,1,0),new s(1,0,0)],i=new B({vertices:t,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:e});(this.convexPolyhedronRepresentation=i).material=this.material}calculateLocalInertia(t,e){return void 0===e&&(e=new n),q.calculateInertia(this.halfExtents,t,e),e}static calculateInertia(t,e,i){i.x=1/12*e*(2*t.y*2*t.y+2*t.z*2*t.z),i.y=1/12*e*(2*t.x*2*t.x+2*t.z*2*t.z),i.z=1/12*e*(2*t.y*2*t.y+2*t.x*2*t.x)}getSideNormals(t,e){var i=t;t=this.halfExtents;if(i[0].set(t.x,0,0),i[1].set(0,t.y,0),i[2].set(0,0,t.z),i[3].set(-t.x,0,0),i[4].set(0,-t.y,0),i[5].set(0,0,-t.z),void 0!==e)for(let s=0;s!==i.length;s++)e.vmult(i[s],i[s]);return i}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(t,e,i){var s=this.halfExtents,o=[[s.x,s.y,s.z],[-s.x,s.y,s.z],[-s.x,-s.y,s.z],[-s.x,-s.y,-s.z],[s.x,-s.y,-s.z],[s.x,s.y,-s.z],[-s.x,s.y,-s.z],[s.x,-s.y,s.z]];for(let n=0;n<o.length;n++)N.set(o[n][0],o[n][1],o[n][2]),e.vmult(N,N),t.vadd(N,N),i(N.x,N.y,N.z)}calculateWorldAABB(t,e,i,s){var o=this.halfExtents;R[0].set(o.x,o.y,o.z),R[1].set(-o.x,o.y,o.z),R[2].set(-o.x,-o.y,o.z),R[3].set(-o.x,-o.y,-o.z),R[4].set(o.x,-o.y,-o.z),R[5].set(o.x,o.y,-o.z),R[6].set(-o.x,o.y,-o.z),R[7].set(o.x,-o.y,o.z);const n=R[0];e.vmult(n,n),t.vadd(n,n),s.copy(n),i.copy(n);for(let h=1;h<8;h++){const o=R[h];e.vmult(o,o),t.vadd(o,o);var r=o.x,a=o.y,l=o.z;r>s.x&&(s.x=r),a>s.y&&(s.y=a),l>s.z&&(s.z=l),r<i.x&&(i.x=r),a<i.y&&(i.y=a),l<i.z&&(i.z=l)}}}const N=new n,R=[new n,new n,new n,new n,new n,new n,new n,new n],T=1,P=2,I=4,j=0,L=1,O=2;class k extends p{constructor(t){void 0===t&&(t={}),super(),this.id=k.idCounter++,this.index=-1,this.world=null,this.vlambda=new n,this.collisionFilterGroup="number"==typeof t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof t.collisionFilterMask?t.collisionFilterMask:-1,this.collisionResponse="boolean"!=typeof t.collisionResponse||t.collisionResponse,this.position=new n,this.previousPosition=new n,this.interpolatedPosition=new n,this.initPosition=new n,t.position&&(this.position.copy(t.position),this.previousPosition.copy(t.position),this.interpolatedPosition.copy(t.position),this.initPosition.copy(t.position)),this.velocity=new n,t.velocity&&this.velocity.copy(t.velocity),this.initVelocity=new n,this.force=new n;var e="number"==typeof t.mass?t.mass:0;this.mass=e,this.invMass=0<e?1/e:0,this.material=t.material||null,this.linearDamping="number"==typeof t.linearDamping?t.linearDamping:.01,this.type=e<=0?k.STATIC:k.DYNAMIC,typeof t.type==typeof k.STATIC&&(this.type=t.type),this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.sleepState=k.AWAKE,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new n,this.quaternion=new v,this.initQuaternion=new v,this.previousQuaternion=new v,this.interpolatedQuaternion=new v,t.quaternion&&(this.quaternion.copy(t.quaternion),this.initQuaternion.copy(t.quaternion),this.previousQuaternion.copy(t.quaternion),this.interpolatedQuaternion.copy(t.quaternion)),this.angularVelocity=new n,t.angularVelocity&&this.angularVelocity.copy(t.angularVelocity),this.initAngularVelocity=new n,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new n,this.invInertia=new n,this.invInertiaWorld=new s,this.invMassSolve=0,this.invInertiaSolve=new n,this.invInertiaWorldSolve=new s,this.fixedRotation=void 0!==t.fixedRotation&&t.fixedRotation,this.angularDamping=void 0!==t.angularDamping?t.angularDamping:.01,this.linearFactor=new n(1,1,1),t.linearFactor&&this.linearFactor.copy(t.linearFactor),this.angularFactor=new n(1,1,1),t.angularFactor&&this.angularFactor.copy(t.angularFactor),this.aabb=new h,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new n,this.isTrigger=Boolean(t.isTrigger),t.shape&&this.addShape(t.shape),this.updateMassProperties()}wakeUp(){var t=this.sleepState;this.sleepState=k.AWAKE,this.wakeUpAfterNarrowphase=!1,t===k.SLEEPING&&this.dispatchEvent(k.wakeupEvent)}sleep(){this.sleepState=k.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(t){var e,i,s;this.allowSleep&&(e=this.sleepState,i=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),s=this.sleepSpeedLimit**2,e===k.AWAKE&&i<s?(this.sleepState=k.SLEEPY,this.timeLastSleepy=t,this.dispatchEvent(k.sleepyEvent)):e===k.SLEEPY&&s<i?this.wakeUp():e===k.SLEEPY&&t-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(k.sleepEvent)))}updateSolveMassProperties(){this.sleepState===k.SLEEPING||this.type===k.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(t,e){return void 0===e&&(e=new n),t.vsub(this.position,e),this.quaternion.conjugate().vmult(e,e),e}vectorToLocalFrame(t,e){return void 0===e&&(e=new n),this.quaternion.conjugate().vmult(t,e),e}pointToWorldFrame(t,e){return void 0===e&&(e=new n),this.quaternion.vmult(t,e),e.vadd(this.position,e),e}vectorToWorldFrame(t,e){return void 0===e&&(e=new n),this.quaternion.vmult(t,e),e}addShape(t,e,i){var s=new n,o=new v;return e&&s.copy(e),i&&o.copy(i),this.shapes.push(t),this.shapeOffsets.push(s),this.shapeOrientations.push(o),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,t.body=this}removeShape(t){var e=this.shapes.indexOf(t);return-1!==e&&(this.shapes.splice(e,1),this.shapeOffsets.splice(e,1),this.shapeOrientations.splice(e,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,t.body=null),this}updateBoundingRadius(){var t=this.shapes,e=this.shapeOffsets,i=t.length;let s=0;for(let r=0;r!==i;r++){var o=t[r],n=(o.updateBoundingSphereRadius(),e[r].length());o=o.boundingSphereRadius;n+o>s&&(s=n+o)}this.boundingRadius=s}updateAABB(){var t=this.shapes,e=this.shapeOffsets,i=this.shapeOrientations,s=t.length,o=W,n=V,r=this.quaternion,a=this.aabb,l=H;for(let u=0;u!==s;u++){var h=t[u];r.vmult(e[u],o),o.vadd(this.position,o),r.mult(i[u],n),h.calculateWorldAABB(o,n,l.lowerBound,l.upperBound),0===u?a.copy(l):a.extend(l)}this.aabbNeedsUpdate=!1}updateInertiaWorld(t){var e,i=this.invInertia;i.x===i.y&&i.y===i.z&&!t||(t=D,e=G,t.setRotationFromQuaternion(this.quaternion),t.transpose(e),t.scale(i,t),t.mmult(e,this.invInertiaWorld))}applyForce(t,e){var i;void 0===e&&(e=new n),this.type===k.DYNAMIC&&(this.sleepState===k.SLEEPING&&this.wakeUp(),i=U,e.cross(t,i),this.force.vadd(t,this.force),this.torque.vadd(i,this.torque))}applyLocalForce(t,e){var i,s;void 0===e&&(e=new n),this.type===k.DYNAMIC&&(i=_,s=Y,this.vectorToWorldFrame(t,i),this.vectorToWorldFrame(e,s),this.applyForce(i,s))}applyTorque(t){this.type===k.DYNAMIC&&(this.sleepState===k.SLEEPING&&this.wakeUp(),this.torque.vadd(t,this.torque))}applyImpulse(t,e){var i;void 0===e&&(e=new n),this.type===k.DYNAMIC&&(this.sleepState===k.SLEEPING&&this.wakeUp(),(i=X).copy(t),i.scale(this.invMass,i),this.velocity.vadd(i,this.velocity),i=K,e.cross(t,i),this.invInertiaWorld.vmult(i,i),this.angularVelocity.vadd(i,this.angularVelocity))}applyLocalImpulse(t,e){var i,s;void 0===e&&(e=new n),this.type===k.DYNAMIC&&(i=Z,s=Q,this.vectorToWorldFrame(t,i),this.vectorToWorldFrame(e,s),this.applyImpulse(i,s))}updateMassProperties(){var t=$,e=(this.invMass=0<this.mass?1/this.mass:0,this.inertia),i=this.fixedRotation;this.updateAABB(),t.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),q.calculateInertia(t,this.mass,e),this.invInertia.set(0<e.x&&!i?1/e.x:0,0<e.y&&!i?1/e.y:0,0<e.z&&!i?1/e.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(t,e){var i=new n;return t.vsub(this.position,i),this.angularVelocity.cross(i,e),this.velocity.vadd(e,e),e}integrate(t,e,i){var s,o,n,r,a,l,h,u,c;this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),this.type!==k.DYNAMIC&&this.type!==k.KINEMATIC||this.sleepState===k.SLEEPING||(s=this.velocity,o=this.angularVelocity,n=this.position,a=this.force,c=this.torque,r=this.quaternion,l=this.invMass,u=this.invInertiaWorld,h=this.linearFactor,s.x+=a.x*(l*=t)*h.x,s.y+=a.y*l*h.y,s.z+=a.z*l*h.z,a=u.elements,l=this.angularFactor,h=c.x*l.x,u=c.y*l.y,c=c.z*l.z,o.x+=t*(a[0]*h+a[1]*u+a[2]*c),o.y+=t*(a[3]*h+a[4]*u+a[5]*c),o.z+=t*(a[6]*h+a[7]*u+a[8]*c),n.x+=s.x*t,n.y+=s.y*t,n.z+=s.z*t,r.integrate(this.angularVelocity,t,this.angularFactor,r),e&&(i?r.normalizeFast():r.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld())}}k.idCounter=0,k.COLLIDE_EVENT_NAME="collide",k.DYNAMIC=T,k.STATIC=P,k.KINEMATIC=I,k.AWAKE=j,k.SLEEPY=L,k.SLEEPING=O,k.wakeupEvent={type:"wakeup"},k.sleepyEvent={type:"sleepy"},k.sleepEvent={type:"sleep"};const W=new n,V=new v,H=new h,D=new s,G=new s,U=(new s,new n),_=new n,Y=new n,X=new n,K=new n,Z=new n,Q=new n,$=new n;class J{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(t,e,i){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(t,e){return 0!=(t.collisionFilterGroup&e.collisionFilterMask)&&0!=(e.collisionFilterGroup&t.collisionFilterMask)&&(0==(t.type&k.STATIC)&&t.sleepState!==k.SLEEPING||0==(e.type&k.STATIC)&&e.sleepState!==k.SLEEPING)}intersectionTest(t,e,i,s){this.useBoundingBoxes?this.doBoundingBoxBroadphase(t,e,i,s):this.doBoundingSphereBroadphase(t,e,i,s)}doBoundingSphereBroadphase(t,e,i,s){var o=tt,n=(e.position.vsub(t.position,o),(t.boundingRadius+e.boundingRadius)**2);o.lengthSquared()<n&&(i.push(t),s.push(e))}doBoundingBoxBroadphase(t,e,i,s){t.aabbNeedsUpdate&&t.updateAABB(),e.aabbNeedsUpdate&&e.updateAABB(),t.aabb.overlaps(e.aabb)&&(i.push(t),s.push(e))}makePairsUnique(t,e){var i=et,s=it,o=st,n=t.length;for(let u=0;u!==n;u++)s[u]=t[u],o[u]=e[u];t.length=0;for(let u=e.length=0;u!==n;u++){var r=s[u].id,a=o[u].id;a=r<a?r+","+a:a+","+r;i[a]=u,i.keys.push(a)}for(let u=0;u!==i.keys.length;u++){var l=i.keys.pop(),h=i[l];t.push(s[h]),e.push(o[h]),delete i[l]}}setWorld(t){}static boundingSphereCheck(t,e){var i=new n;t.position.vsub(e.position,i),t=t.shapes[0],e=e.shapes[0];return Math.pow(t.boundingSphereRadius+e.boundingSphereRadius,2)>i.lengthSquared()}aabbQuery(t,e,i){return[]}}const tt=new n,et=(new n,new v,new n,{keys:[]}),it=[],st=[];new n,new n,new n;class ot extends J{constructor(){super()}collisionPairs(t,e,i){var s,o,n=t.bodies,r=n.length;for(let a=0;a!==r;a++)for(let t=0;t!==a;t++)s=n[a],o=n[t],this.needBroadphaseCollision(s,o)&&this.intersectionTest(s,o,e,i)}aabbQuery(t,e,i){void 0===i&&(i=[]);for(let o=0;o<t.bodies.length;o++){var s=t.bodies[o];s.aabbNeedsUpdate&&s.updateAABB(),s.aabb.overlaps(e)&&i.push(s)}return i}}class nt{constructor(){this.rayFromWorld=new n,this.rayToWorld=new n,this.hitNormalWorld=new n,this.hitPointWorld=new n,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(t,e,i,s,o,n,r){this.rayFromWorld.copy(t),this.rayToWorld.copy(e),this.hitNormalWorld.copy(i),this.hitPointWorld.copy(s),this.shape=o,this.body=n,this.distance=r}}const rt=1,at=2,lt=4;e=E.types.SPHERE,i=E.types.PLANE,m=E.types.BOX,f=E.types.CYLINDER,g=E.types.CONVEXPOLYHEDRON,x=E.types.HEIGHTFIELD,b=E.types.TRIMESH;class ht{get[e](){return this._intersectSphere}get[i](){return this._intersectPlane}get[m](){return this._intersectBox}get[f](){return this._intersectConvex}get[g](){return this._intersectConvex}get[x](){return this._intersectHeightfield}get[b](){return this._intersectTrimesh}constructor(t,e){void 0===t&&(t=new n),void 0===e&&(e=new n),this.from=t.clone(),this.to=e.clone(),this.direction=new n,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=ht.ANY,this.result=new nt,this.hasHit=!1,this.callback=t=>{}}intersectWorld(t,e){return this.mode=e.mode||ht.ANY,this.result=e.result||new nt,this.skipBackfaces=!!e.skipBackfaces,this.collisionFilterMask=void 0!==e.collisionFilterMask?e.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==e.collisionFilterGroup?e.collisionFilterGroup:-1,this.checkCollisionResponse=void 0===e.checkCollisionResponse||e.checkCollisionResponse,e.from&&this.from.copy(e.from),e.to&&this.to.copy(e.to),this.callback=e.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(ut),ct.length=0,t.broadphase.aabbQuery(t,ut,ct),this.intersectBodies(ct),this.hasHit}intersectBody(t,e){e&&(this.result=e,this.updateDirection());var i=this.checkCollisionResponse;if((!i||t.collisionResponse)&&0!=(this.collisionFilterGroup&t.collisionFilterMask)&&0!=(t.collisionFilterGroup&this.collisionFilterMask)){var s=vt,o=yt;for(let e=0,r=t.shapes.length;e<r;e++){var n=t.shapes[e];if((!i||n.collisionResponse)&&(t.quaternion.mult(t.shapeOrientations[e],o),t.quaternion.vmult(t.shapeOffsets[e],s),s.vadd(t.position,s),this.intersectShape(n,o,s,t),this.result.shouldStop))break}}}intersectBodies(t,e){e&&(this.result=e,this.updateDirection());for(let i=0,s=t.length;!this.result.shouldStop&&i<s;i++)this.intersectBody(t[i])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(t,e,i,s){var o,n,r,a=this.from;o=this.direction,(n=i).vsub(a,jt),r=jt.dot(o),o.scale(r,Lt),Lt.vadd(a,Lt),o=n.distanceTo(Lt),o>t.boundingSphereRadius||(r=this[t.type])&&r.call(this,t,e,i,s,t)}_intersectBox(t,e,i,s,o){return this._intersectConvex(t.convexPolyhedronRepresentation,e,i,s,o)}_intersectPlane(t,e,i,s,o){var r,a=this.from,l=this.to,h=this.direction,u=new n(0,0,1),c=(e=(e.vmult(u,u),new n),a.vsub(i,e),e.dot(u));l.vsub(i,e),e=e.dot(u);0<c*e||a.distanceTo(l)<c||(e=u.dot(h),Math.abs(e)<this.precision)||(l=new n,c=new n,r=new n,a.vsub(i,l),i=-u.dot(l)/e,h.scale(i,c),a.vadd(c,r),this.reportIntersection(u,r,o,s,-1))}getAABB(t){var{lowerBound:t,upperBound:e}=t,i=this.to,s=this.from;t.x=Math.min(i.x,s.x),t.y=Math.min(i.y,s.y),t.z=Math.min(i.z,s.z),e.x=Math.max(i.x,s.x),e.y=Math.max(i.y,s.y),e.z=Math.max(i.z,s.z)}_intersectHeightfield(t,e,i,s,o){t.data,t.elementSize;var n,r,a,l=Et,u=(l.from.copy(this.from),l.to.copy(this.to),z.pointToLocalFrame(i,e,l.from,l.from),z.pointToLocalFrame(i,e,l.to,l.to),l.updateDirection(),zt),c=r=t.data.length-1,d=new h;l.getAABB(d),t.getIndexOfPosition(d.lowerBound.x,d.lowerBound.y,u,!0),a=Math.max(0,u[0]),n=Math.max(0,u[1]),t.getIndexOfPosition(d.upperBound.x,d.upperBound.y,u,!0),c=Math.min(c,u[0]+1),r=Math.min(r,u[1]+1);for(let h=a;h<c;h++)for(let a=n;a<r;a++){if(this.result.shouldStop)return;if(t.getAabbAtIndex(h,a,d),d.overlapsRay(l)){if(t.getConvexTrianglePillar(h,a,!1),z.pointToWorldFrame(i,e,t.pillarOffset,bt),this._intersectConvex(t.pillarConvex,e,bt,s,o,xt),this.result.shouldStop)return;t.getConvexTrianglePillar(h,a,!0),z.pointToWorldFrame(i,e,t.pillarOffset,bt),this._intersectConvex(t.pillarConvex,e,bt,s,o,xt)}}}_intersectSphere(t,e,i,s,o){var n,r=this.from,a=this.to,l=(t=t.radius,(a.x-r.x)**2+(a.y-r.y)**2+(a.z-r.z)**2),h=2*((a.x-r.x)*(r.x-i.x)+(a.y-r.y)*(r.y-i.y)+(a.z-r.z)*(r.z-i.z)),u=(t=h**2-4*l*((r.x-i.x)**2+(r.y-i.y)**2+(r.z-i.z)**2-t**2),St),c=Bt;t<0||(0==t?(r.lerp(a,t,u),u.vsub(i,c),c.normalize(),this.reportIntersection(c,u,o,s,-1)):(n=(-h-Math.sqrt(t))/(2*l),h=(-h+Math.sqrt(t))/(2*l),0<=n&&n<=1&&(r.lerp(a,n,u),u.vsub(i,c),c.normalize(),this.reportIntersection(c,u,o,s,-1)),this.result.shouldStop||0<=h&&h<=1&&(r.lerp(a,h,u),u.vsub(i,c),c.normalize(),this.reportIntersection(c,u,o,s,-1))))}_intersectConvex(t,e,i,s,o,n){var r=At,a=Ct,l=n&&n.faceList||null,h=t.faces,u=t.vertices,c=t.faceNormals,d=this.direction,p=this.from,v=(n=this.to,p.distanceTo(n)),y=(l||h).length,w=this.result;for(let z=0;!w.shouldStop&&z<y;z++){var m=l?l[z]:z,f=h[m],g=c[m],x=e,b=i;g=(a.copy(u[f[0]]),x.vmult(a,a),a.vadd(b,a),a.vsub(p,a),x.vmult(g,r),d.dot(r));if(!(Math.abs(g)<this.precision)&&(g=r.dot(a)/g,!(g<0))){d.scale(g,wt),wt.vadd(p,wt),mt.copy(u[f[0]]),x.vmult(mt,mt),b.vadd(mt,mt);for(let t=1;!w.shouldStop&&t<f.length-1;t++){ft.copy(u[f[t]]),gt.copy(u[f[t+1]]),x.vmult(ft,ft),x.vmult(gt,gt),b.vadd(ft,ft),b.vadd(gt,gt);var E=wt.distanceTo(p);!ht.pointInTriangle(wt,mt,ft,gt)&&!ht.pointInTriangle(wt,ft,mt,gt)||v<E||this.reportIntersection(r,wt,o,s,m)}}}}_intersectTrimesh(t,e,i,s,o,n){var r=Mt,a=Pt,l=It,h=Ct,u=Ft,c=qt,d=Nt,p=Tt,v=Rt,y=t.indices,w=(t.vertices,this.from),m=this.to,f=this.direction,g=(l.position.copy(i),l.quaternion.copy(e),z.vectorToLocalFrame(i,e,f,u),z.pointToLocalFrame(i,e,w,c),z.pointToLocalFrame(i,e,m,d),d.x*=t.scale.x,d.y*=t.scale.y,d.z*=t.scale.z,c.x*=t.scale.x,c.y*=t.scale.y,c.z*=t.scale.z,d.vsub(c,u),u.normalize(),c.distanceSquared(d));t.tree.rayQuery(this,l,a);for(let E=0,S=a.length;!this.result.shouldStop&&E!==S;E++){var x=a[E],b=(t.getNormal(x,r),t.getVertex(y[3*x],mt),mt.vsub(c,h),u.dot(r));b=r.dot(h)/b;b<0||(u.scale(b,wt),wt.vadd(c,wt),t.getVertex(y[3*x+1],ft),t.getVertex(y[3*x+2],gt),b=wt.distanceSquared(c),!ht.pointInTriangle(wt,ft,mt,gt)&&!ht.pointInTriangle(wt,mt,ft,gt))||g<b||(z.vectorToWorldFrame(e,r,v),z.pointToWorldFrame(i,e,wt,p),this.reportIntersection(v,p,o,s,x))}a.length=0}reportIntersection(t,e,i,s,o){var n=this.from,r=this.to,a=n.distanceTo(e),l=this.result;if(!(this.skipBackfaces&&0<t.dot(this.direction)))switch(l.hitFaceIndex=void 0!==o?o:-1,this.mode){case ht.ALL:this.hasHit=!0,l.set(n,r,t,e,i,s,a),l.hasHit=!0,this.callback(l);break;case ht.CLOSEST:(a<l.distance||!l.hasHit)&&(this.hasHit=!0,l.hasHit=!0,l.set(n,r,t,e,i,s,a));break;case ht.ANY:this.hasHit=!0,l.hasHit=!0,l.set(n,r,t,e,i,s,a),l.shouldStop=!0}}static pointInTriangle(t,e,i,s){s.vsub(e,jt),i.vsub(e,dt),t.vsub(e,pt);s=jt.dot(jt),i=jt.dot(dt),t=jt.dot(pt),e=dt.dot(dt);var o,n=dt.dot(pt);let r;return 0<=(o=e*t-i*n)&&0<=(r=s*n-i*t)&&o+r<s*e-i*i}}ht.CLOSEST=rt,ht.ANY=at,ht.ALL=lt;const ut=new h,ct=[],dt=new n,pt=new n,vt=new n,yt=new v,wt=new n,mt=new n,ft=new n,gt=new n,xt=(new n,new nt,{faceList:[0]}),bt=new n,Et=new ht,zt=[],St=new n,Bt=new n,At=new n,Ct=(new n,new n,new n),Mt=new n,Ft=new n,qt=new n,Nt=new n,Rt=new n,Tt=new n,Pt=(new h,[]),It=new z,jt=new n,Lt=new n;class Ot{static defaults(t,e){for(var i in void 0===t&&(t={}),e)i in t||(t[i]=e[i]);return t}}class kt{constructor(t,e,i){void 0===i&&(i={}),i=Ot.defaults(i,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.id=kt.idCounter++,this.collideConnected=i.collideConnected,i.wakeUpBodies&&(t&&t.wakeUp(),e)&&e.wakeUp()}update(){throw new Error("method update() not implmemented in this Constraint subclass!")}enable(){var t=this.equations;for(let e=0;e<t.length;e++)t[e].enabled=!0}disable(){var t=this.equations;for(let e=0;e<t.length;e++)t[e].enabled=!1}}kt.idCounter=0;class Wt{constructor(){this.spatial=new n,this.rotational=new n}multiplyElement(t){return t.spatial.dot(this.spatial)+t.rotational.dot(this.rotational)}multiplyVectors(t,e){return t.dot(this.spatial)+e.dot(this.rotational)}}class Vt{constructor(t,e,i,s){void 0===i&&(i=-1e6),void 0===s&&(s=1e6),this.id=Vt.idCounter++,this.minForce=i,this.maxForce=s,this.bi=t,this.bj=e,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new Wt,this.jacobianElementB=new Wt,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(t,e,i){this.a=4/(i*(1+4*e)),this.b=4*e/(1+4*e),this.eps=4/(i*i*t*(1+4*e))}computeB(t,e,i){var s=this.computeGW();return-this.computeGq()*t-s*e-this.computeGiMf()*i}computeGq(){var t=this.jacobianElementA,e=this.jacobianElementB,i=this.bi,s=this.bj;i=i.position,s=s.position;return t.spatial.dot(i)+e.spatial.dot(s)}computeGW(){var t=this.jacobianElementA,e=this.jacobianElementB,i=this.bi,s=this.bj,o=i.velocity,n=s.velocity;i=i.angularVelocity,s=s.angularVelocity;return t.multiplyVectors(o,i)+e.multiplyVectors(n,s)}computeGWlambda(){var t=this.jacobianElementA,e=this.jacobianElementB,i=this.bi,s=this.bj,o=i.vlambda,n=s.vlambda;i=i.wlambda,s=s.wlambda;return t.multiplyVectors(o,i)+e.multiplyVectors(n,s)}computeGiMf(){var t=this.jacobianElementA,e=this.jacobianElementB,i=this.bi,s=this.bj,o=i.force,n=i.torque,r=s.force,a=s.torque,l=i.invMassSolve,h=s.invMassSolve;return o.scale(l,Ht),r.scale(h,Dt),i.invInertiaWorldSolve.vmult(n,Gt),s.invInertiaWorldSolve.vmult(a,Ut),t.multiplyVectors(Ht,Gt)+e.multiplyVectors(Dt,Ut)}computeGiMGt(){var t=this.jacobianElementA,e=this.jacobianElementB,i=this.bi,s=this.bj,o=i.invMassSolve,n=s.invMassSolve;i=i.invInertiaWorldSolve,s=s.invInertiaWorldSolve,o+=n;return i.vmult(t.rotational,_t),o+=_t.dot(t.rotational),s.vmult(e.rotational,_t),o+_t.dot(e.rotational)}addToWlambda(t){var e=this.jacobianElementA,i=this.jacobianElementB,s=this.bi,o=this.bj,n=Yt;s.vlambda.addScaledVector(s.invMassSolve*t,e.spatial,s.vlambda),o.vlambda.addScaledVector(o.invMassSolve*t,i.spatial,o.vlambda),s.invInertiaWorldSolve.vmult(e.rotational,n),s.wlambda.addScaledVector(t,n,s.wlambda),o.invInertiaWorldSolve.vmult(i.rotational,n),o.wlambda.addScaledVector(t,n,o.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}Vt.idCounter=0;const Ht=new n,Dt=new n,Gt=new n,Ut=new n,_t=new n,Yt=new n;class Xt extends Vt{constructor(t,e,i){super(t,e,0,i=void 0===i?1e6:i),this.restitution=0,this.ri=new n,this.rj=new n,this.ni=new n}computeB(t){var e=this.a,i=this.b,s=this.bi,o=this.bj,n=this.ri,r=this.rj,a=Kt,l=Zt,h=s.velocity,u=s.angularVelocity,c=(s.force,s.torque,o.velocity),d=o.angularVelocity,p=(o.force,o.torque,Qt),v=this.jacobianElementA,y=this.jacobianElementB,w=this.ni;n.cross(w,a),r.cross(w,l),w.negate(v.spatial),a.negate(v.rotational),y.spatial.copy(w),y.rotational.copy(l),p.copy(o.position),p.vadd(r,p),p.vsub(s.position,p),p.vsub(n,p),v=w.dot(p),y=this.restitution+1;return-v*e-(y*c.dot(w)-y*h.dot(w)+d.dot(l)-u.dot(a))*i-t*this.computeGiMf()}getImpactVelocityAlongNormal(){var t=$t,e=Jt,i=te,s=ee,o=ie;return this.bi.position.vadd(this.ri,i),this.bj.position.vadd(this.rj,s),this.bi.getVelocityAtWorldPoint(i,t),this.bj.getVelocityAtWorldPoint(s,e),t.vsub(e,o),this.ni.dot(o)}}const Kt=new n,Zt=new n,Qt=new n,$t=new n,Jt=new n,te=new n,ee=new n,ie=new n;new n,new n,new n,new n,new n,new n,new n,new n,new n,new n;class se extends Vt{constructor(t,e,i){super(t,e,-i,i),this.ri=new n,this.rj=new n,this.t=new n}computeB(t){this.a;var e=this.b,i=(this.bi,this.bj,this.ri),s=this.rj,o=oe,n=ne,r=this.t;i.cross(r,o),s.cross(r,n),i=this.jacobianElementA,s=this.jacobianElementB,r.negate(i.spatial),o.negate(i.rotational),s.spatial.copy(r),s.rotational.copy(n),o=this.computeGW();return-o*e-t*this.computeGiMf()}}const oe=new n,ne=new n;class re{constructor(t,e,i){i=Ot.defaults(i,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=re.idCounter++,this.materials=[t,e],this.friction=i.friction,this.restitution=i.restitution,this.contactEquationStiffness=i.contactEquationStiffness,this.contactEquationRelaxation=i.contactEquationRelaxation,this.frictionEquationStiffness=i.frictionEquationStiffness,this.frictionEquationRelaxation=i.frictionEquationRelaxation}}re.idCounter=0;class ae{constructor(t){let e="";"string"==typeof(t=void 0===t?{}:t)&&(e=t,t={}),this.name=e,this.id=ae.idCounter++,this.friction=void 0!==t.friction?t.friction:-1,this.restitution=void 0!==t.restitution?t.restitution:-1}}ae.idCounter=0,new n,new n,new n,new n,new n,new n,new n,new n,new n,new n,new n,new n,new n,new n,new n,new n,new n,new n,new n,new ht,new n,new n,new n,new n(1,0,0),new n(0,1,0),new n(0,0,1),new n,new n,new n,new n,new n,new n,new n,new n,new n,new n,new n,new n,new n,new n,new n,new n,new n,new n,new n,new n;class le extends E{constructor(){super({type:E.types.PLANE}),this.worldNormal=new n,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(t){var e=this.worldNormal;e.set(0,0,1),t.vmult(e,e),this.worldNormalNeedsUpdate=!1}calculateLocalInertia(t,e){return void 0===e?new n:e}volume(){return Number.MAX_VALUE}calculateWorldAABB(t,e,i,s){he.set(0,0,1),e.vmult(he,he),e=Number.MAX_VALUE,i.set(-e,-e,-e),s.set(e,e,e),1===he.x?s.x=t.x:-1===he.x&&(i.x=t.x),1===he.y?s.y=t.y:-1===he.y&&(i.y=t.y),1===he.z?s.z=t.z:-1===he.z&&(i.z=t.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=Number.MAX_VALUE}}const he=new n;new n,new n,new n,new n,new n,new n,new n,new n,new n,new n,new h,new n,new h,new n,new n,new n,new n,new n,new n,new n,new h,new n,new z,new h;class ue{constructor(){this.equations=[]}solve(t,e){return 0}addEquation(t){!t.enabled||t.bi.isTrigger||t.bj.isTrigger||this.equations.push(t)}removeEquation(t){var e=this.equations;t=e.indexOf(t);-1!==t&&e.splice(t,1)}removeAllEquations(){this.equations.length=0}}class ce extends ue{constructor(){super(),this.iterations=10,this.tolerance=1e-7}solve(t,e){let i=0;var s=this.iterations,o=this.tolerance*this.tolerance,n=this.equations,r=n.length,a=e.bodies,l=a.length,h=t;let u,c;if(0!==r)for(let C=0;C!==l;C++)a[C].updateSolveMassProperties();var d=pe,p=ve,v=de;d.length=r,p.length=r,v.length=r;for(let C=0;C!==r;C++){var y=n[C];v[C]=0,p[C]=y.computeB(h),d[C]=1/y.computeC()}if(0!==r){for(let e=0;e!==l;e++){var w=a[e],m=w.vlambda;w=w.wlambda;m.set(0,0,0),w.set(0,0,0)}for(i=0;i!==s;i++){for(let t=c=0;t!==r;t++){var f=n[t],g=p[t],x=d[t],b=v[t],E=f.computeGWlambda();b+(u=x*(g-E-f.eps*b))<f.minForce?u=f.minForce-b:b+u>f.maxForce&&(u=f.maxForce-b),v[t]+=u,c+=0<u?u:-u,f.addToWlambda(u)}if(c*c<o)break}for(let e=0;e!==l;e++){var z=a[e],S=z.velocity,B=z.angularVelocity;z.vlambda.vmul(z.linearFactor,z.vlambda),S.vadd(z.vlambda,S),z.wlambda.vmul(z.angularFactor,z.wlambda),B.vadd(z.wlambda,B)}let t=n.length;for(var A=1/h;t--;)n[t].multiplier=v[t]*A}return i}}const de=[],pe=[],ve=[];k.STATIC;class ye extends class{constructor(){this.objects=[],this.type=Object}release(){var t=arguments.length;for(let e=0;e!==t;e++)this.objects.push(e<0||arguments.length<=e?void 0:arguments[e]);return this}get(){return 0===this.objects.length?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(t){for(var e=this.objects;e.length>t;)e.pop();for(;e.length<t;)e.push(this.constructObject());return this}}{constructor(){super(...arguments),this.type=n}constructObject(){return new n}}const we=E.types.SPHERE,me=E.types.SPHERE|E.types.PLANE,fe=E.types.BOX|E.types.BOX,ge=E.types.SPHERE|E.types.BOX,xe=E.types.PLANE|E.types.BOX,be=E.types.CONVEXPOLYHEDRON,Ee=E.types.SPHERE|E.types.CONVEXPOLYHEDRON,ze=E.types.PLANE|E.types.CONVEXPOLYHEDRON,Se=E.types.BOX|E.types.CONVEXPOLYHEDRON,Be=E.types.SPHERE|E.types.HEIGHTFIELD,Ae=E.types.BOX|E.types.HEIGHTFIELD,Ce=E.types.CONVEXPOLYHEDRON|E.types.HEIGHTFIELD,Me=E.types.PARTICLE|E.types.SPHERE,Fe=E.types.PLANE|E.types.PARTICLE,qe=E.types.BOX|E.types.PARTICLE,Ne=E.types.PARTICLE|E.types.CONVEXPOLYHEDRON,Re=E.types.CYLINDER,Te=E.types.SPHERE|E.types.CYLINDER,Pe=E.types.PLANE|E.types.CYLINDER,Ie=E.types.BOX|E.types.CYLINDER,je=E.types.CONVEXPOLYHEDRON|E.types.CYLINDER,Le=E.types.HEIGHTFIELD|E.types.CYLINDER,Oe=E.types.PARTICLE|E.types.CYLINDER,ke=E.types.SPHERE|E.types.TRIMESH,We=E.types.PLANE|E.types.TRIMESH;class Ve{get[we](){return this.sphereSphere}get[me](){return this.spherePlane}get[fe](){return this.boxBox}get[ge](){return this.sphereBox}get[xe](){return this.planeBox}get[be](){return this.convexConvex}get[Ee](){return this.sphereConvex}get[ze](){return this.planeConvex}get[Se](){return this.boxConvex}get[Be](){return this.sphereHeightfield}get[Ae](){return this.boxHeightfield}get[Ce](){return this.convexHeightfield}get[Me](){return this.sphereParticle}get[Fe](){return this.planeParticle}get[qe](){return this.boxParticle}get[Ne](){return this.convexParticle}get[Re](){return this.convexConvex}get[Te](){return this.sphereConvex}get[Pe](){return this.planeConvex}get[Ie](){return this.boxConvex}get[je](){return this.convexConvex}get[Le](){return this.heightfieldCylinder}get[Oe](){return this.particleCylinder}get[ke](){return this.sphereTrimesh}get[We](){return this.planeTrimesh}constructor(t){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new ye,this.world=t,this.currentContactMaterial=t.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(t,e,i,s,o,n){let r;this.contactPointPool.length?((r=this.contactPointPool.pop()).bi=t,r.bj=e):r=new Xt(t,e),r.enabled=t.collisionResponse&&e.collisionResponse&&i.collisionResponse&&s.collisionResponse;var a=this.currentContactMaterial;r.restitution=a.restitution,r.setSpookParams(a.contactEquationStiffness,a.contactEquationRelaxation,this.world.dt),a=i.material||t.material,t=s.material||e.material;return a&&t&&0<=a.restitution&&0<=t.restitution&&(r.restitution=a.restitution*t.restitution),r.si=o||i,r.sj=n||s,r}createFrictionEquationsFromContact(t,e){var i=t.bi,s=t.bj,o=t.si,n=t.sj,r=this.world,a=this.currentContactMaterial;let l=a.friction;if(o=o.material||i.material,n=n.material||s.material,0<(l=o&&n&&0<=o.friction&&0<=n.friction?o.friction*n.friction:l)){o=l*(r.frictionGravity||r.gravity).length();let u=i.invMass+s.invMass;0<u&&(u=1/u);n=this.frictionEquationPool;var h=n.length?n.pop():new se(i,s,o*u);n=n.length?n.pop():new se(i,s,o*u);return h.bi=n.bi=i,h.bj=n.bj=s,h.minForce=n.minForce=-o*u,h.maxForce=n.maxForce=o*u,h.ri.copy(t.ri),h.rj.copy(t.rj),n.ri.copy(t.ri),n.rj.copy(t.rj),t.ni.tangents(h.t,n.t),h.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,r.dt),n.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,r.dt),h.enabled=n.enabled=t.enabled,e.push(h,n),!0}return!1}createFrictionFromAverage(t){var e=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(e,this.frictionResult)&&1!==t){var i=this.frictionResult[this.frictionResult.length-2],s=this.frictionResult[this.frictionResult.length-1],o=(He.setZero(),De.setZero(),Ge.setZero(),e.bi);e.bj;for(let i=0;i!==t;i++)(e=this.result[this.result.length-1-i]).bi!==o?(He.vadd(e.ni,He),De.vadd(e.ri,De),Ge.vadd(e.rj,Ge)):(He.vsub(e.ni,He),De.vadd(e.rj,De),Ge.vadd(e.ri,Ge));var n=1/t;De.scale(n,i.ri),Ge.scale(n,i.rj),s.ri.copy(i.ri),s.rj.copy(i.rj),He.normalize(),He.tangents(i.t,s.t)}}getContacts(t,e,i,s,o,n,r){this.contactPointPool=o,this.frictionEquationPool=r,this.result=s,this.frictionResult=n;var a=Ye,l=Xe,h=Ue,u=_e;for(let m=0,f=t.length;m!==f;m++){var c=t[m],d=e[m];let s=null;c.material&&d.material&&(s=i.getContactMaterial(c.material,d.material)||null);var p=c.type&k.KINEMATIC&&d.type&k.STATIC||c.type&k.STATIC&&d.type&k.KINEMATIC||c.type&k.KINEMATIC&&d.type&k.KINEMATIC;for(let t=0;t<c.shapes.length;t++){c.quaternion.mult(c.shapeOrientations[t],a),c.quaternion.vmult(c.shapeOffsets[t],h),h.vadd(c.position,h);var v=c.shapes[t];for(let t=0;t<d.shapes.length;t++){d.quaternion.mult(d.shapeOrientations[t],l),d.quaternion.vmult(d.shapeOffsets[t],u),u.vadd(d.position,u);var y=d.shapes[t];if(v.collisionFilterMask&y.collisionFilterGroup&&y.collisionFilterMask&v.collisionFilterGroup&&!(h.distanceTo(u)>v.boundingSphereRadius+y.boundingSphereRadius)){let t=null;v.material&&y.material&&(t=i.getContactMaterial(v.material,y.material)||null),this.currentContactMaterial=t||s||i.defaultContactMaterial;var w=this[v.type|y.type];if(w){let t=!1;(t=v.type<y.type?w.call(this,v,y,h,u,a,l,c,d,v,y,p):w.call(this,y,v,u,h,l,a,d,c,v,y,p))&&p&&(i.shapeOverlapKeeper.set(v.id,y.id),i.bodyOverlapKeeper.set(c.id,d.id))}}}}}}sphereSphere(t,e,i,s,o,n,r,a,l,h,u){if(u)return i.distanceSquared(s)<(t.radius+e.radius)**2;u=this.createContactEquation(r,a,t,e,l,h),s.vsub(i,u.ni),u.ni.normalize(),u.ri.copy(u.ni),u.rj.copy(u.ni),u.ri.scale(t.radius,u.ri),u.rj.scale(-e.radius,u.rj),u.ri.vadd(i,u.ri),u.ri.vsub(r.position,u.ri),u.rj.vadd(s,u.rj),u.rj.vsub(a.position,u.rj),this.result.push(u),this.createFrictionEquationsFromContact(u,this.frictionResult)}spherePlane(t,e,i,s,o,n,r,a,l,h,u){if(e=this.createContactEquation(r,a,t,e,l,h),e.ni.set(0,0,1),n.vmult(e.ni,e.ni),e.ni.negate(e.ni),e.ni.normalize(),e.ni.scale(t.radius,e.ri),i.vsub(s,pi),e.ni.scale(e.ni.dot(pi),vi),pi.vsub(vi,e.rj),-pi.dot(e.ni)<=t.radius){if(u)return!0;l=e.ri,h=e.rj,l.vadd(i,l),l.vsub(r.position,l),h.vadd(s,h),h.vsub(a.position,h),this.result.push(e),this.createFrictionEquationsFromContact(e,this.frictionResult)}}boxBox(t,e,i,s,o,n,r,a,l,h,u){return t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e.convexPolyhedronRepresentation,i,s,o,n,r,a,t,e,u)}sphereBox(t,e,i,s,o,n,r,a,l,h,u){var c=this.v3pool,d=Ei,p=(i.vsub(s,fi),e.getSideNormals(d,n),t.radius);let v=!1;var y=Si,w=Bi,m=Ai;let f=null,g=0,x=0,b=0,E=null;for(let H=0,D=d.length;H!==D&&!1===v;H++){var z=gi,S=(z.copy(d[H]),z.length()),B=(z.normalize(),fi.dot(z));if(B<S+p&&0<B){var A=xi,C=bi,M=(A.copy(d[(H+1)%3]),C.copy(d[(H+2)%3]),A.length()),F=C.length(),q=(A.normalize(),C.normalize(),fi.dot(A)),N=fi.dot(C);if(q<M&&-M<q&&N<F&&-F<N){const t=Math.abs(B-S-p);if((null===E||t<E)&&(E=t,x=q,b=N,f=S,y.copy(z),w.copy(A),m.copy(C),g++,u))return!0}}}if(g){v=!0;const o=this.createContactEquation(r,a,t,e,l,h);y.scale(-p,o.ri),o.ni.copy(y),o.ni.negate(o.ni),y.scale(f,y),w.scale(x,w),y.vadd(w,y),m.scale(b,m),y.vadd(m,o.rj),o.ri.vadd(i,o.ri),o.ri.vsub(r.position,o.ri),o.rj.vadd(s,o.rj),o.rj.vsub(a.position,o.rj),this.result.push(o),this.createFrictionEquationsFromContact(o,this.frictionResult)}let R=c.get();var T=zi;for(let H=0;2!==H&&!v;H++)for(let o=0;2!==o&&!v;o++)for(let n=0;2!==n&&!v;n++)if(R.set(0,0,0),H?R.vadd(d[0],R):R.vsub(d[0],R),o?R.vadd(d[1],R):R.vsub(d[1],R),n?R.vadd(d[2],R):R.vsub(d[2],R),s.vadd(R,T),T.vsub(i,T),T.lengthSquared()<p*p){if(u)return!0;v=!0;const o=this.createContactEquation(r,a,t,e,l,h);o.ri.copy(T),o.ri.normalize(),o.ni.copy(o.ri),o.ri.scale(p,o.ri),o.rj.copy(R),o.ri.vadd(i,o.ri),o.ri.vsub(r.position,o.ri),o.rj.vadd(s,o.rj),o.rj.vsub(a.position,o.rj),this.result.push(o),this.createFrictionEquationsFromContact(o,this.frictionResult)}c.release(R),R=null;var P=c.get(),I=c.get();const j=c.get();var L=c.get();const O=c.get();var k=d.length;for(let H=0;H!==k&&!v;H++)for(let o=0;o!==k&&!v;o++)if(H%3!=o%3){d[o].cross(d[H],P),P.normalize(),d[H].vadd(d[o],I),j.copy(i),j.vsub(I,j),j.vsub(s,j);var W=j.dot(P);P.scale(W,L);let n=0;for(;n===H%3||n===o%3;)n++;O.copy(i),O.vsub(L,O),O.vsub(I,O),O.vsub(s,O);W=Math.abs(W);var V=O.length();if(W<d[n].length()&&V<p){if(u)return!0;v=!0,W=this.createContactEquation(r,a,t,e,l,h),I.vadd(L,W.rj),W.rj.copy(W.rj),O.negate(W.ni),W.ni.normalize(),W.ri.copy(W.rj),W.ri.vadd(s,W.ri),W.ri.vsub(i,W.ri),W.ri.normalize(),W.ri.scale(p,W.ri),W.ri.vadd(i,W.ri),W.ri.vsub(r.position,W.ri),W.rj.vadd(s,W.rj),W.rj.vsub(a.position,W.rj),this.result.push(W),this.createFrictionEquationsFromContact(W,this.frictionResult)}}c.release(P,I,j,L,O)}planeBox(t,e,i,s,o,n,r,a,l,h,u){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,e.convexPolyhedronRepresentation.id=e.id,this.planeConvex(t,e.convexPolyhedronRepresentation,i,s,o,n,r,a,t,e,u)}convexConvex(t,e,i,s,o,n,r,a,l,h,u,c,d){var p=Vi;if(!(i.distanceTo(s)>t.boundingSphereRadius+e.boundingSphereRadius)&&t.findSeparatingAxis(e,i,o,s,n,p,c,d)){var v=[],y=Hi;t.clipAgainstHull(i,o,e,s,n,p,-100,100,v);let c=0;for(let o=0;o!==v.length;o++){if(u)return!0;var w=this.createContactEquation(r,a,t,e,l,h),m=w.ri,f=w.rj;p.negate(w.ni),v[o].normal.negate(y),y.scale(v[o].depth,y),v[o].point.vadd(y,m),f.copy(v[o].point),m.vsub(i,m),f.vsub(s,f),m.vadd(i,m),m.vsub(r.position,m),f.vadd(s,f),f.vsub(a.position,f),this.result.push(w),c++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(w,this.frictionResult)}this.enableFrictionReduction&&c&&this.createFrictionFromAverage(c)}}sphereConvex(t,e,i,s,o,n,r,a,l,h,u){var c=this.v3pool,d=(i.vsub(s,Ci),e.faceNormals),p=e.faces,v=e.vertices,y=t.radius;let w=!1;for(let P=0;P!==v.length;P++){var m=v[P],f=Ni;m=(n.vmult(m,f),s.vadd(f,f),qi);if(f.vsub(i,m),m.lengthSquared()<y*y){if(u)return!0;w=!0;var g=this.createContactEquation(r,a,t,e,l,h);return g.ri.copy(m),g.ri.normalize(),g.ni.copy(g.ri),g.ri.scale(y,g.ri),f.vsub(s,g.rj),g.ri.vadd(i,g.ri),g.ri.vsub(r.position,g.ri),g.rj.vadd(s,g.rj),g.rj.vsub(a.position,g.rj),this.result.push(g),void this.createFrictionEquationsFromContact(g,this.frictionResult)}}for(let P=0,I=p.length;P!==I&&!1===w;P++){var x=d[P],b=p[P],E=Ri,z=(x=(n.vmult(x,E),Ti),n.vmult(v[b[0]],x),x.vadd(s,x),Pi),S=(E.scale(-y,z),i.vadd(z,z),Ii);z=(z.vsub(x,S),S.dot(E)),S=ji;if(i.vsub(x,S),z<0&&0<S.dot(E)){var B=[];for(let t=0,e=b.length;t!==e;t++){var A=c.get();n.vmult(v[b[t]],A),s.vadd(A,A),B.push(A)}if(function(t,e,i){let s=null;var o=t.length;for(let l=0;l!==o;l++){var n=t[l],r=yi,a=(t[(l+1)%o].vsub(n,r),wi);r=(r.cross(e,a),mi),n=(i.vsub(n,r),a.dot(r));if(!(null===s||0<n&&!0===s||n<=0&&!1===s))return;null===s&&(s=0<n)}return 1}(B,E,i)){if(u)return!0;w=!0,x=this.createContactEquation(r,a,t,e,l,h),E.scale(-y,x.ri),E.negate(x.ni),S=c.get(),E.scale(-z,S),z=c.get(),E.scale(-y,z),i.vsub(s,x.rj),x.rj.vadd(z,x.rj),x.rj.vadd(S,x.rj),x.rj.vadd(s,x.rj),x.rj.vsub(a.position,x.rj),x.ri.vadd(i,x.ri),x.ri.vsub(r.position,x.ri),c.release(S),c.release(z),this.result.push(x),this.createFrictionEquationsFromContact(x,this.frictionResult);for(let t=0,e=B.length;t!==e;t++)c.release(B[t]);return}for(let o=0;o!==b.length;o++){var C=c.get(),M=c.get(),F=(n.vmult(v[b[(o+1)%b.length]],C),n.vmult(v[b[(o+2)%b.length]],M),s.vadd(C,C),s.vadd(M,M),Mi),q=(M.vsub(C,F),Fi),N=(F.unit(q),c.get()),R=c.get(),T=(i.vsub(C,R),R.dot(q));q=(q.scale(T,N),N.vadd(C,N),c.get());if(N.vsub(i,q),0<T&&T*T<F.lengthSquared()&&q.lengthSquared()<y*y){if(u)return!0;T=this.createContactEquation(r,a,t,e,l,h),N.vsub(s,T.rj),N.vsub(i,T.ni),T.ni.normalize(),T.ni.scale(y,T.ri),T.rj.vadd(s,T.rj),T.rj.vsub(a.position,T.rj),T.ri.vadd(i,T.ri),T.ri.vsub(r.position,T.ri),this.result.push(T),this.createFrictionEquationsFromContact(T,this.frictionResult);for(let t=0,e=B.length;t!==e;t++)c.release(B[t]);return c.release(C),c.release(M),c.release(N),c.release(q),void c.release(R)}c.release(C),c.release(M),c.release(N),c.release(q),c.release(R)}for(let t=0,e=B.length;t!==e;t++)c.release(B[t])}}}planeConvex(t,e,i,s,o,n,r,a,l,h,u){var c=Li,d=Oi;d.set(0,0,1),o.vmult(d,d);let p=0;var v=ki;for(let m=0;m!==e.vertices.length;m++)if(c.copy(e.vertices[m]),n.vmult(c,c),s.vadd(c,c),c.vsub(i,v),d.dot(v)<=0){if(u)return!0;var y=this.createContactEquation(r,a,t,e,l,h),w=Wi;d.scale(d.dot(v),w),c.vsub(w,w),w.vsub(i,y.ri),y.ni.copy(d),c.vsub(s,y.rj),y.ri.vadd(i,y.ri),y.ri.vsub(r.position,y.ri),y.rj.vadd(s,y.rj),y.rj.vsub(a.position,y.rj),this.result.push(y),p++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(y,this.frictionResult)}this.enableFrictionReduction&&p&&this.createFrictionFromAverage(p)}boxConvex(t,e,i,s,o,n,r,a,l,h,u){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e,i,s,o,n,r,a,t,e,u)}sphereHeightfield(t,e,i,s,o,n,r,a,l,h,u){var c=e.data,d=t.radius,p=e.elementSize,v=is,y=es;z.pointToLocalFrame(s,n,i,y);let w=Math.floor((y.x-d)/p)-1,m=Math.ceil((y.x+d)/p)+1,f=Math.floor((y.y-d)/p)-1,g=Math.ceil((y.y+d)/p)+1;if(!(m<0||g<0||w>c.length||f>c[0].length)&&(w<0&&(w=0),m<0&&(m=0),f<0&&(f=0),g<0&&(g=0),w>=c.length&&(w=c.length-1),m>=c.length&&(m=c.length-1),g>=c[0].length&&(g=c[0].length-1),f>=c[0].length&&(f=c[0].length-1),p=[],e.getRectMinMax(w,f,m,g,p),c=p[0],p=p[1],!(y.z-d>p||y.z+d<c))){var x=this.result;for(let l=w;l<m;l++)for(let h=f;h<g;h++){var b=x.length;let c=!1;if(e.getConvexTrianglePillar(l,h,!1),z.pointToWorldFrame(s,n,e.pillarOffset,v),i.distanceTo(v)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(c=this.sphereConvex(t,e.pillarConvex,i,v,o,n,r,a,t,e,u)),u&&c)return!0;if(e.getConvexTrianglePillar(l,h,!0),z.pointToWorldFrame(s,n,e.pillarOffset,v),i.distanceTo(v)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(c=this.sphereConvex(t,e.pillarConvex,i,v,o,n,r,a,t,e,u)),u&&c)return!0;if(2<x.length-b)return}}}boxHeightfield(t,e,i,s,o,n,r,a,l,h,u){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexHeightfield(t.convexPolyhedronRepresentation,e,i,s,o,n,r,a,t,e,u)}convexHeightfield(t,e,i,s,o,n,r,a,l,h,u){var c=e.data,d=e.elementSize,p=t.boundingSphereRadius,v=Ji,y=ts,w=$i;z.pointToLocalFrame(s,n,i,w);let m=Math.floor((w.x-p)/d)-1,f=Math.ceil((w.x+p)/d)+1,g=Math.floor((w.y-p)/d)-1,x=Math.ceil((w.y+p)/d)+1;if(!(f<0||x<0||m>c.length||g>c[0].length)&&(m<0&&(m=0),f<0&&(f=0),g<0&&(g=0),x<0&&(x=0),m>=c.length&&(m=c.length-1),f>=c.length&&(f=c.length-1),x>=c[0].length&&(x=c[0].length-1),g>=c[0].length&&(g=c[0].length-1),d=[],e.getRectMinMax(m,g,f,x,d),c=d[0],d=d[1],!(w.z-p>d||w.z+p<c)))for(let b=m;b<f;b++)for(let l=g;l<x;l++){let h=!1;if(e.getConvexTrianglePillar(b,l,!1),z.pointToWorldFrame(s,n,e.pillarOffset,v),i.distanceTo(v)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(h=this.convexConvex(t,e.pillarConvex,i,v,o,n,r,a,null,null,u,y,null)),u&&h)return!0;if(e.getConvexTrianglePillar(b,l,!0),z.pointToWorldFrame(s,n,e.pillarOffset,v),i.distanceTo(v)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(h=this.convexConvex(t,e.pillarConvex,i,v,o,n,r,a,null,null,u,y,null)),u&&h)return!0}}sphereParticle(t,e,i,s,o,n,r,a,l,h,u){var c=_i;c.set(0,0,1),s.vsub(i,c),s=c.lengthSquared();if(s<=t.radius*t.radius){if(u)return!0;i=this.createContactEquation(a,r,e,t,l,h),c.normalize(),i.rj.copy(c),i.rj.scale(t.radius,i.rj),i.ni.copy(c),i.ni.negate(i.ni),i.ri.set(0,0,0),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}}planeParticle(t,e,i,s,o,n,r,a,l,h,u){var c=Di,d=(c.set(0,0,1),r.quaternion.vmult(c,c),Gi);s.vsub(r.position,d),d=c.dot(d);if(d<=0){if(u)return!0;d=this.createContactEquation(a,r,e,t,l,h),d.ni.copy(c),d.ni.negate(d.ni),d.ri.set(0,0,0),u=Ui,c.scale(c.dot(s),u),s.vsub(u,u),d.rj.copy(u),this.result.push(d),this.createFrictionEquationsFromContact(d,this.frictionResult)}}boxParticle(t,e,i,s,o,n,r,a,l,h,u){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexParticle(t.convexPolyhedronRepresentation,e,i,s,o,n,r,a,t,e,u)}convexParticle(t,e,i,s,o,n,r,a,l,h,u){let c=-1;var d=Ki,p=Qi;let v=null;var y=Xi;if(y.copy(s),y.vsub(i,y),o.conjugate(Yi),Yi.vmult(y,y),t.pointIsInside(y)){t.worldVerticesNeedsUpdate&&t.computeWorldVertices(i,o),t.worldFaceNormalsNeedsUpdate&&t.computeWorldFaceNormals(o);for(let e=0,i=t.faces.length;e!==i;e++){var w=[t.worldVertices[t.faces[e][0]]],m=t.worldFaceNormals[e];w=(s.vsub(w[0],Zi),-m.dot(Zi));if(null===v||Math.abs(w)<Math.abs(v)){if(u)return!0;v=w,c=e,d.copy(m)}}-1!==c&&(y=this.createContactEquation(a,r,e,t,l,h),d.scale(v,p),p.vadd(s,p),p.vsub(i,p),y.rj.copy(p),d.negate(y.ni),y.ri.set(0,0,0),o=y.ri,e=y.rj,o.vadd(s,o),o.vsub(a.position,o),e.vadd(i,e),e.vsub(r.position,e),this.result.push(y),this.createFrictionEquationsFromContact(y,this.frictionResult))}}heightfieldCylinder(t,e,i,s,o,n,r,a,l,h,u){return this.convexHeightfield(e,t,s,i,n,o,a,r,l,h,u)}particleCylinder(t,e,i,s,o,n,r,a,l,h,u){return this.convexParticle(e,t,s,i,n,o,a,r,l,h,u)}sphereTrimesh(t,e,i,s,o,n,r,a,l,h,u){var c=ii,d=si,p=oi,v=ni,y=ri,w=ai,m=ci,f=ei,g=Je,x=di,b=(z.pointToLocalFrame(s,n,i,y),t.radius),E=(m.lowerBound.set(y.x-b,y.y-b,y.z-b),m.upperBound.set(y.x+b,y.y+b,y.z+b),e.getTrianglesInAABB(m,x),ti),S=t.radius*t.radius;for(let T=0;T<x.length;T++)for(let o=0;o<3;o++)if(e.getVertex(e.indices[3*x[T]+o],E),E.vsub(y,g),g.lengthSquared()<=S){if(f.copy(E),z.pointToWorldFrame(s,n,f,E),E.vsub(i,g),u)return!0;var B=this.createContactEquation(r,a,t,e,l,h);B.ni.copy(g),B.ni.normalize(),B.ri.copy(B.ni),B.ri.scale(t.radius,B.ri),B.ri.vadd(i,B.ri),B.ri.vsub(r.position,B.ri),B.rj.copy(E),B.rj.vsub(a.position,B.rj),this.result.push(B),this.createFrictionEquationsFromContact(B,this.frictionResult)}for(let T=0;T<x.length;T++)for(let o=0;o<3;o++){e.getVertex(e.indices[3*x[T]+o],c),e.getVertex(e.indices[3*x[T]+(o+1)%3],d),d.vsub(c,p),y.vsub(d,w);var A=w.dot(p),C=(y.vsub(c,w),w.dot(p));if(0<C&&A<0&&(y.vsub(c,w),v.copy(p),v.normalize(),C=w.dot(v),v.scale(C,w),w.vadd(c,w),w.distanceTo(y)<t.radius)){if(u)return!0;A=this.createContactEquation(r,a,t,e,l,h),w.vsub(y,A.ni),A.ni.normalize(),A.ni.scale(t.radius,A.ri),A.ri.vadd(i,A.ri),A.ri.vsub(r.position,A.ri),z.pointToWorldFrame(s,n,w,w),w.vsub(a.position,A.rj),z.vectorToWorldFrame(n,A.ni,A.ni),z.vectorToWorldFrame(n,A.ri,A.ri),this.result.push(A),this.createFrictionEquationsFromContact(A,this.frictionResult)}}var M=li,F=hi,q=ui,N=$e;for(let T=0,P=x.length;T!==P;T++){e.getTriangleVertices(x[T],M,F,q),e.getNormal(x[T],N),y.vsub(M,w);var R=w.dot(N);if(N.scale(R,w),y.vsub(w,w),R=w.distanceTo(y),ht.pointInTriangle(w,M,F,q)&&R<t.radius){if(u)return!0;R=this.createContactEquation(r,a,t,e,l,h),w.vsub(y,R.ni),R.ni.normalize(),R.ni.scale(t.radius,R.ri),R.ri.vadd(i,R.ri),R.ri.vsub(r.position,R.ri),z.pointToWorldFrame(s,n,w,w),w.vsub(a.position,R.rj),z.vectorToWorldFrame(n,R.ni,R.ni),z.vectorToWorldFrame(n,R.ri,R.ri),this.result.push(R),this.createFrictionEquationsFromContact(R,this.frictionResult)}}x.length=0}planeTrimesh(t,e,i,s,o,r,a,l,h,u,c){var d=new n,p=Ke;p.set(0,0,1),o.vmult(p,p);for(let m=0;m<e.vertices.length/3;m++){e.getVertex(m,d);var v=new n,y=(v=(v.copy(d),z.pointToWorldFrame(s,r,v,d),Ze),d.vsub(i,v),p.dot(v));if(y<=0){if(c)return!0;y=this.createContactEquation(a,l,t,e,h,u);var w=(y.ni.copy(p),Qe);p.scale(v.dot(p),w),d.vsub(w,w),y.ri.copy(w),y.ri.vsub(a.position,y.ri),y.rj.copy(d),y.rj.vsub(l.position,y.rj),this.result.push(y),this.createFrictionEquationsFromContact(y,this.frictionResult)}}}}const He=new n,De=new n,Ge=new n,Ue=new n,_e=new n,Ye=new v,Xe=new v,Ke=new n,Ze=new n,Qe=new n,$e=new n,Je=new n,ti=(new n,new n),ei=new n,ii=new n,si=new n,oi=new n,ni=new n,ri=new n,ai=new n,li=new n,hi=new n,ui=new n,ci=new h,di=[],pi=new n,vi=new n,yi=new n,wi=new n,mi=new n,fi=new n,gi=new n,xi=new n,bi=new n,Ei=[new n,new n,new n,new n,new n,new n],zi=new n,Si=new n,Bi=new n,Ai=new n,Ci=new n,Mi=new n,Fi=new n,qi=new n,Ni=new n,Ri=new n,Ti=new n,Pi=new n,Ii=new n,ji=new n,Li=(new n,new n,new n),Oi=new n,ki=new n,Wi=new n,Vi=new n,Hi=new n,Di=new n,Gi=new n,Ui=new n,_i=new n,Yi=new v,Xi=new n,Ki=(new n,new n),Zi=new n,Qi=new n,$i=new n,Ji=new n,ts=[0],es=new n,is=new n;class ss{constructor(){this.current=[],this.previous=[]}getKey(t,e){var i;return e<t&&(i=e,e=t,t=i),t<<16|e}set(t,e){var i=this.getKey(t,e),s=this.current;let o=0;for(;i>s[o];)o++;if(i!==s[o]){for(let t=s.length-1;t>=o;t--)s[t+1]=s[t];s[o]=i}}tick(){var t=this.current;this.current=this.previous,this.previous=t,this.current.length=0}getDiff(t,e){var i=this.current,s=this.previous,o=i.length,n=s.length;let r=0;for(let h=0;h<o;h++){for(var a=i[h];a>s[r];)r++;a===s[r]||os(t,a)}for(let h=r=0;h<n;h++){for(var l=s[h];l>i[r];)r++;i[r]===l||os(e,l)}}}function os(t,e){t.push((4294901760&e)>>16,65535&e)}const ns=(t,e)=>t<e?t+"-"+e:e+"-"+t;class rs{constructor(){this.data={keys:[]}}get(t,e){return t=ns(t,e),this.data[t]}set(t,e,i){var s=ns(t,e);this.get(t,e)||this.data.keys.push(s),this.data[s]=i}delete(t,e){t=ns(t,e),e=this.data.keys.indexOf(t),-1!==e&&this.data.keys.splice(e,1),delete this.data[t]}reset(){for(var t=this.data,e=t.keys;0<e.length;)delete t[e.pop()]}}class as extends p{constructor(t){void 0===t&&(t={}),super(),this.dt=-1,this.allowSleep=!!t.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=void 0!==t.quatNormalizeSkip?t.quatNormalizeSkip:0,this.quatNormalizeFast=void 0!==t.quatNormalizeFast&&t.quatNormalizeFast,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new n,t.gravity&&this.gravity.copy(t.gravity),t.frictionGravity&&(this.frictionGravity=new n,this.frictionGravity.copy(t.frictionGravity)),this.broadphase=void 0!==t.broadphase?t.broadphase:new ot,this.bodies=[],this.hasActiveBodies=!1,this.solver=void 0!==t.solver?t.solver:new ce,this.constraints=[],this.narrowphase=new Ve(this),this.collisionMatrix=new d,this.collisionMatrixPrevious=new d,this.bodyOverlapKeeper=new ss,this.shapeOverlapKeeper=new ss,this.contactmaterials=[],this.contactMaterialTable=new rs,this.defaultMaterial=new ae("default"),this.defaultContactMaterial=new re(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(t,e){return this.contactMaterialTable.get(t.id,e.id)}collisionMatrixTick(){var t=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=t,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(t){this.constraints.push(t)}removeConstraint(t){t=this.constraints.indexOf(t),-1!==t&&this.constraints.splice(t,1)}rayTest(t,e,i){i instanceof nt?this.raycastClosest(t,e,{skipBackfaces:!0},i):this.raycastAll(t,e,{skipBackfaces:!0},i)}raycastAll(t,e,i,s){return(i=void 0===i?{}:i).mode=ht.ALL,i.from=t,i.to=e,i.callback=s,ls.intersectWorld(this,i)}raycastAny(t,e,i,s){return(i=void 0===i?{}:i).mode=ht.ANY,i.from=t,i.to=e,i.result=s,ls.intersectWorld(this,i)}raycastClosest(t,e,i,s){return(i=void 0===i?{}:i).mode=ht.CLOSEST,i.from=t,i.to=e,i.result=s,ls.intersectWorld(this,i)}addBody(t){this.bodies.includes(t)||(t.index=this.bodies.length,this.bodies.push(t),t.world=this,t.initPosition.copy(t.position),t.initVelocity.copy(t.velocity),t.timeLastSleepy=this.time,t instanceof k&&(t.initAngularVelocity.copy(t.angularVelocity),t.initQuaternion.copy(t.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=t,this.idToBodyMap[t.id]=t,this.dispatchEvent(this.addBodyEvent))}removeBody(t){t.world=null;var e=this.bodies.length-1,i=this.bodies,s=i.indexOf(t);if(-1!==s){i.splice(s,1);for(let t=0;t!==i.length;t++)i[t].index=t;this.collisionMatrix.setNumObjects(e),this.removeBodyEvent.body=t,delete this.idToBodyMap[t.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(t){return this.idToBodyMap[t]}getShapeById(t){var e=this.bodies;for(let o=0;o<e.length;o++){var i=e[o].shapes;for(let e=0;e<i.length;e++){var s=i[e];if(s.id===t)return s}}return null}addContactMaterial(t){this.contactmaterials.push(t),this.contactMaterialTable.set(t.materials[0].id,t.materials[1].id,t)}removeContactMaterial(t){var e=this.contactmaterials.indexOf(t);-1!==e&&(this.contactmaterials.splice(e,1),this.contactMaterialTable.delete(t.materials[0].id,t.materials[1].id))}fixedStep(t,e){void 0===t&&(t=1/60),void 0===e&&(e=10);var i,s=hs.now()/1e3;this.lastCallTime?(i=s-this.lastCallTime,this.step(t,i,e)):this.step(t,void 0,e),this.lastCallTime=s}step(t,e,i){if(void 0===i&&(i=10),void 0===e)this.internalStep(t),this.time+=t;else{this.accumulator+=e;var s=hs.now();let r=0;for(;this.accumulator>=t&&r<i&&(this.internalStep(t),this.accumulator-=t,r++,!(hs.now()-s>1e3*t)););this.accumulator=this.accumulator%t;var o=this.accumulator/t;for(let t=0;t!==this.bodies.length;t++){var n=this.bodies[t];n.previousPosition.lerp(n.position,o,n.interpolatedPosition),n.previousQuaternion.slerp(n.quaternion,o,n.interpolatedQuaternion),n.previousQuaternion.normalize()}this.time+=e}}internalStep(t){this.dt=t;var e=this.contacts,i=ys,s=ws,o=this.bodies.length,n=this.bodies,r=this.solver,a=this.gravity,l=this.doProfiling,h=this.profile,u=k.DYNAMIC;let c=-1/0;var d=this.constraints,p=vs,v=(a.length(),a.x),y=a.y,w=a.z;let m=0;for(l&&(c=hs.now()),m=0;m!==o;m++){var f,g=n[m];g.type===u&&(f=g.force,g=g.mass,f.x+=g*v,f.y+=g*y,f.z+=g*w)}for(let k=0,G=this.subsystems.length;k!==G;k++)this.subsystems[k].update();l&&(c=hs.now()),i.length=0,s.length=0,this.broadphase.collisionPairs(this,i,s),l&&(h.broadphase=hs.now()-c);let x=d.length;for(m=0;m!==x;m++){var b=d[m];if(!b.collideConnected)for(let t=i.length-1;0<=t;--t)(b.bodyA===i[t]&&b.bodyB===s[t]||b.bodyB===i[t]&&b.bodyA===s[t])&&(i.splice(t,1),s.splice(t,1))}this.collisionMatrixTick(),l&&(c=hs.now());var E=ps,z=e.length;for(m=0;m!==z;m++)E.push(e[m]);e.length=0;var S=this.frictionEquations.length;for(m=0;m!==S;m++)p.push(this.frictionEquations[m]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(i,s,this,e,E,this.frictionEquations,p),l&&(h.narrowphase=hs.now()-c),l&&(c=hs.now()),m=0;m<this.frictionEquations.length;m++)r.addEquation(this.frictionEquations[m]);var B=e.length;for(let G=0;G!==B;G++){var A,C=e[G],M=C.bi,F=C.bj,q=C.si,N=C.sj;let t;(t=M.material&&F.material&&this.getContactMaterial(M.material,F.material)||this.defaultContactMaterial).friction,M.material&&F.material&&(0<=M.material.friction&&0<=F.material.friction&&(M.material.friction,F.material.friction),0<=M.material.restitution)&&0<=F.material.restitution&&(C.restitution=M.material.restitution*F.material.restitution),r.addEquation(C),M.allowSleep&&M.type===k.DYNAMIC&&M.sleepState===k.SLEEPING&&F.sleepState===k.AWAKE&&F.type!==k.STATIC&&(A=F.velocity.lengthSquared()+F.angularVelocity.lengthSquared(),2*F.sleepSpeedLimit**2<=A)&&(M.wakeUpAfterNarrowphase=!0),F.allowSleep&&F.type===k.DYNAMIC&&F.sleepState===k.SLEEPING&&M.sleepState===k.AWAKE&&M.type!==k.STATIC&&(A=M.velocity.lengthSquared()+M.angularVelocity.lengthSquared(),2*M.sleepSpeedLimit**2<=A)&&(F.wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(M,F,!0),this.collisionMatrixPrevious.get(M,F)||(ds.body=F,ds.contact=C,M.dispatchEvent(ds),ds.body=M,F.dispatchEvent(ds)),this.bodyOverlapKeeper.set(M.id,F.id),this.shapeOverlapKeeper.set(q.id,N.id)}for(this.emitContactEvents(),l&&(h.makeContactConstraints=hs.now()-c,c=hs.now()),m=0;m!==o;m++){var R=n[m];R.wakeUpAfterNarrowphase&&(R.wakeUp(),R.wakeUpAfterNarrowphase=!1)}for(x=d.length,m=0;m!==x;m++){var T=d[m];T.update();for(let t=0,e=T.equations.length;t!==e;t++){var P=T.equations[t];r.addEquation(P)}}r.solve(t,this),l&&(h.solve=hs.now()-c),r.removeAllEquations();var I=Math.pow;for(m=0;m!==o;m++){var j,L,O=n[m];O.type&u&&(j=I(1-O.linearDamping,t),(L=O.velocity).scale(j,L),j=O.angularVelocity)&&(L=I(1-O.angularDamping,t),j.scale(L,j))}this.dispatchEvent(cs),l&&(c=hs.now());var W=this.stepnumber%(this.quatNormalizeSkip+1)==0,V=this.quatNormalizeFast;for(m=0;m!==o;m++)n[m].integrate(t,W,V);this.clearForces(),this.broadphase.dirty=!0,l&&(h.integrate=hs.now()-c),this.stepnumber+=1,this.dispatchEvent(us);let H=!0;if(this.allowSleep)for(H=!1,m=0;m!==o;m++){var D=n[m];D.sleepTick(this.time),D.sleepState!==k.SLEEPING&&(H=!0)}this.hasActiveBodies=H}emitContactEvents(){var t=this.hasAnyEventListener("beginContact"),e=this.hasAnyEventListener("endContact");if((t||e)&&this.bodyOverlapKeeper.getDiff(ms,fs),t){for(let t=0,e=ms.length;t<e;t+=2)gs.bodyA=this.getBodyById(ms[t]),gs.bodyB=this.getBodyById(ms[t+1]),this.dispatchEvent(gs);gs.bodyA=gs.bodyB=null}if(e){for(let t=0,e=fs.length;t<e;t+=2)xs.bodyA=this.getBodyById(fs[t]),xs.bodyB=this.getBodyById(fs[t+1]),this.dispatchEvent(xs);xs.bodyA=xs.bodyB=null}if(ms.length=fs.length=0,t=this.hasAnyEventListener("beginShapeContact"),e=this.hasAnyEventListener("endShapeContact"),(t||e)&&this.shapeOverlapKeeper.getDiff(ms,fs),t){for(let t=0,e=ms.length;t<e;t+=2){var i=this.getShapeById(ms[t]),s=this.getShapeById(ms[t+1]);bs.shapeA=i,bs.shapeB=s,i&&(bs.bodyA=i.body),s&&(bs.bodyB=s.body),this.dispatchEvent(bs)}bs.bodyA=bs.bodyB=bs.shapeA=bs.shapeB=null}if(e){for(let t=0,e=fs.length;t<e;t+=2){var o=this.getShapeById(fs[t]),n=this.getShapeById(fs[t+1]);Es.shapeA=o,Es.shapeB=n,o&&(Es.bodyA=o.body),n&&(Es.bodyB=n.body),this.dispatchEvent(Es)}Es.bodyA=Es.bodyB=Es.shapeA=Es.shapeB=null}}clearForces(){var t=this.bodies,e=t.length;for(let s=0;s!==e;s++){var i=t[s];i.force,i.torque,i.force.set(0,0,0),i.torque.set(0,0,0)}}}new h;const ls=new ht,hs=globalThis.performance||{};if(!hs.now){let t=Date.now();hs.timing&&hs.timing.navigationStart&&(t=hs.timing.navigationStart),hs.now=()=>Date.now()-t}new n;const us={type:"postStep"},cs={type:"preStep"},ds={type:k.COLLIDE_EVENT_NAME,body:null,contact:null},ps=[],vs=[],ys=[],ws=[],ms=[],fs=[],gs={type:"beginContact",bodyA:null,bodyB:null},xs={type:"endContact",bodyA:null,bodyB:null},bs={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},Es={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null}},7906:function(t,e,i){i(8409)},3020:function(t,e,i){t.exports=i.p+"media/1.c053db37.mp3"},8570:function(t,e,i){i.d(e,{C:function(){return o}});var s=i(1458);class o extends s.xsS{constructor(t=null){super();var e=new s.DvJ,i=(e.deleteAttribute("uv"),new s.Wid({side:s._Li})),o=new s.Wid;let r=5;null!==t&&!1===t.useLegacyLights&&(r=900),t=new s.cek(16777215,r,28,2),t.position.set(.418,16.199,.3),this.add(t),t=new s.Kj0(e,i),t.position.set(-.757,13.219,.717),t.scale.set(31.713,28.305,28.591),this.add(t),i=new s.Kj0(e,o),i.position.set(-10.906,2.009,1.846),i.rotation.set(0,-.195,0),i.scale.set(2.328,7.905,4.651),this.add(i),t=new s.Kj0(e,o),t.position.set(-5.607,-.754,-.758),t.rotation.set(0,.994,0),t.scale.set(1.97,1.534,3.955),this.add(t),i=new s.Kj0(e,o),i.position.set(6.167,.857,7.803),i.rotation.set(0,.561,0),i.scale.set(3.927,6.285,3.687),this.add(i),t=new s.Kj0(e,o),t.position.set(-2.017,.018,6.124),t.rotation.set(0,.333,0),t.scale.set(2.002,4.566,2.064),this.add(t),i=new s.Kj0(e,o),i.position.set(2.291,-.756,-2.621),i.rotation.set(0,-.286,0),i.scale.set(1.546,1.552,1.496),this.add(i),t=new s.Kj0(e,o),t.position.set(-2.193,-.369,-5.547),t.rotation.set(0,.516,0),t.scale.set(3.875,3.487,2.986),this.add(t),i=new s.Kj0(e,n(50)),i.position.set(-16.116,14.37,8.208),i.scale.set(.1,2.428,2.739),this.add(i),o=new s.Kj0(e,n(50)),o.position.set(-16.109,18.021,-8.207),o.scale.set(.1,2.425,2.751),this.add(o),t=new s.Kj0(e,n(17)),t.position.set(14.904,12.198,-1.832),t.scale.set(.15,4.265,6.331),this.add(t),i=new s.Kj0(e,n(43)),i.position.set(-.462,8.89,14.52),i.scale.set(4.38,5.441,.088),this.add(i),o=new s.Kj0(e,n(20)),o.position.set(3.235,11.486,-12.541),o.scale.set(2.5,2,.1),this.add(o),t=new s.Kj0(e,n(100)),t.position.set(0,20,0),t.scale.set(1,.1,1),this.add(t)}dispose(){const t=new Set;this.traverse((e=>{e.isMesh&&(t.add(e.geometry),t.add(e.material))}));for(const e of t)e.dispose()}}function n(t){var e=new s.vBJ;return e.color.setScalar(t),e}}}]);